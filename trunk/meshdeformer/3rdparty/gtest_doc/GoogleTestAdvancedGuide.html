<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
 


 
 
 


 <link rel="icon" type="image/vnd.microsoft.icon" href="http://www.gstatic.com/codesite/ph/images/phosting.ico">
 
 <script type="text/javascript">
 
 
 
 var codesite_token = null;
 
 
 var logged_in_user_email = null;
 
 
 var relative_base_url = "";
 
 </script>
 
 
 <title>GoogleTestAdvancedGuide - 
 googletest -
 
 Advanced topics on using Google C++ Testing Framework - Project Hosting on Google Code</title>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 
 <link type="text/css" rel="stylesheet" href="GoogleTestAdvancedGuide_files/ph_core.css">
 
 <link type="text/css" rel="stylesheet" href="GoogleTestAdvancedGuide_files/ph_detail.css">
 
 
 
 <link type="application/atom+xml" rel="alternate" href="http://code.google.com/feeds/p/googletest/svnchanges/basic?path=/wiki/GoogleTestAdvancedGuide.wiki">
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/11550098825063786370/css/d_ie.css" >
<![endif]-->
 <style type="text/css">
 .menuIcon.off { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -42px }
 .menuIcon.on { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -28px }
 .menuIcon.down { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 0; }
 </style>
<script src="GoogleTestAdvancedGuide_files/ga.js" type="text/javascript"></script></head><body class="t6">
 <script type="text/javascript">
 var _gaq = _gaq || [];
 _gaq.push(
 ['siteTracker._setAccount', 'UA-18071-1'],
 ['siteTracker._trackPageview']);
 
 _gaq.push(
 ['projectTracker._setAccount', 'UA-4068653-1'],
 ['projectTracker._trackPageview']);
 
 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
 </script>
 <div id="gaia">
 
 <span>
 
 
 <a href="#" id="projects-dropdown" onclick="return false;"><u>My favorites</u> <small>â–¼</small></a>
 
 | <a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogletest%2Fwiki%2FGoogleTestAdvancedGuide&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogletest%2Fwiki%2FGoogleTestAdvancedGuide" onclick="_CS_click('/gb/ph/signin');"><u>Sign in</u></a>
 
 </span>

 </div>
 <div class="gbh" style="left: 0pt;"></div>
 <div class="gbh" style="right: 0pt;"></div>
 
 
 <div style="height: 1px;"></div>
<!--[if IE 6]>
<div style="text-align:center;">
Support browsers that contribute to open source, try <a href="http://www.firefox.com">Firefox</a> or <a href="http://www.google.com/chrome">Google Chrome</a>.
</div>
<![endif]-->



 <table style="margin: 20px 0px 0px; padding: 0px; width: 100%;" cellpadding="0" cellspacing="0">
 <tbody><tr style="height: 58px;">
 
 <td style="width: 55px; text-align: center;">
 <a href="http://code.google.com/p/googletest/">
 
 
 <img src="GoogleTestAdvancedGuide_files/code_small.png" alt="Logo">
 
 
 </a>
 </td>
 
 <td style="padding-left: 0.5em;">
 
 <div id="pname" style="margin: 0px 0px -3px;">
 <a href="http://code.google.com/p/googletest/" style="text-decoration: none; color: rgb(0, 0, 0);">googletest</a>
 
 </div>
 <div id="psum">
 <i><a id="project_summary_link" href="http://code.google.com/p/googletest/" style="text-decoration: none; color: rgb(0, 0, 0);">Google C++ Testing Framework</a></i>
 </div>
 
 </td>
 <td style="white-space: nowrap; text-align: right;">
 <form action="/hosting/search">
 <input size="30" name="q">
 <input name="projectsearch" value="Search projects" type="submit">
 </form>
 </td></tr>
 </tbody></table>


 
<table id="mt" width="100%" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
 <th onclick="if (!cancelBubble) _go('/p/googletest/');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/googletest/">Project&nbsp;Home</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 <th onclick="if (!cancelBubble) _go('/p/googletest/downloads/list');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/googletest/downloads/list">Downloads</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 
 <th onclick="if (!cancelBubble) _go('/p/googletest/w/list');">
 <div class="tab active">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/googletest/w/list">Wiki</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 
 <th onclick="if (!cancelBubble) _go('/p/googletest/issues/list');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/googletest/issues/list">Issues</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 
 <th onclick="if (!cancelBubble) _go('/p/googletest/source/checkout');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/googletest/source/checkout">Source</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 <td width="100%">&nbsp;</td>
 </tr>
</tbody></table>
<table class="st" width="100%" border="0" cellpadding="0" cellspacing="0" align="center">
 <tbody><tr>
 
 
 
 <td>
 <div class="issueDetail">
<div class="isf">
 
 <span class="inIssueList"> 
 <span>Search</span>
 <form action="/p/googletest/w/list" method="GET" style="display: inline;">
 <select id="can" name="can" style="font-size: 92%;">
 <option disabled="disabled">Search within:</option>
 
 <option value="1">&nbsp;All wiki pages</option>
 <option value="3">&nbsp;Featured pages</option>
 <option value="2" selected="selected">&nbsp;Current pages</option>
 
 
 <option value="4">&nbsp;Deprecated pages</option>
 
 </select>
 <span>for</span>
 <span id="qq"><input size="38" id="q" name="q" style="font-size: 92%;" type="text"></span>
 
 
 <input value="Search" style="font-size: 92%;" type="submit">
 </form>
 </span>

 
 
 
 
 
 
 

</div>
</div>

 </td>
 
 
 
 
 
 
 <td class="bevel-right" height="4" valign="top" align="right">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 </td>
 </tr>
</tbody></table>
<script type="text/javascript">
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>


<div id="maincol">

 
<!-- IE -->







 <style type="text/css">
 .artifactcomment {
 margin: .5em 0 0 0;
 padding: .3em 0 .3em .3em;
 border-top: 3px solid #c3d9ff;
 }
 #commentlist {
 border-bottom: 3px solid #c3d9ff;
 }
 #commentform { padding-top: 1em; }
 .delcom { background: #e8e8e8 }
 .commentcontent { margin: 1em 0;}
 </style>


 <div id="wikicontent">
 <table width="100%" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
 
 <td class="vt" id="wikimaincol" width="100%">
 
 <div style="float: right; width: 18em;" id="wikimeta">
 <div class="pmeta_bubble_bg">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <table style="padding: 5px;">
 <tbody><tr><td colspan="2" style="padding-bottom: 5px;">Updated <span title="Thu Apr  8 10:55:26 2010">Apr 08, 2010</span>
 
 by <a style="white-space: nowrap;" href="http://code.google.com/u/vladlosev/">vladlosev</a>
 </td></tr>
 
 <tr><th class="vt">Labels:</th>
 <td>
 
 <a href="http://code.google.com/p/googletest/w/list?q=label:Featured" title="Listed on project home page">Featured</a>
 
 </td>
 </tr>
 
 
 
 </tbody></table>
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 </div>
 
 <div id="wikiheader" style="margin-bottom: 1em;">
 
 <span style="font-size: 120%; font-weight: bold;">GoogleTestAdvancedGuide</span>
 &nbsp;
 
 
 <div style="font-style: italic; margin-top: 3px;">Advanced topics on using Google C++ Testing Framework</div>
 
 </div>
 <p></p><ul><li><a href="#More_Assertions">More Assertions</a></li><ul><li><a href="#Explicit_Success_and_Failure">Explicit Success and Failure</a></li><li><a href="#Exception_Assertions">Exception Assertions</a></li><li><a href="#Predicate_Assertions_for_Better_Error_Messages">Predicate Assertions for Better Error Messages</a></li><ul><li><a href="#Using_an_Existing_Boolean_Function">Using an Existing Boolean Function</a></li><li><a href="#Using_a_Function_That_Returns_an_AssertionResult">Using a Function That Returns an AssertionResult</a></li><li><a href="#Using_a_Predicate-Formatter">Using a Predicate-Formatter</a></li></ul><li><a href="#Floating-Point_Comparison">Floating-Point Comparison</a></li><ul><li><a href="#Floating-Point_Macros">Floating-Point Macros</a></li><li><a href="#Floating-Point_Predicate-Format_Functions">Floating-Point Predicate-Format Functions</a></li></ul><li><a href="#Windows_HRESULT_assertions">Windows HRESULT assertions</a></li><li><a href="#Type_Assertions">Type Assertions</a></li><li><a href="#Assertion_Placement">Assertion Placement</a></li></ul><li><a href="#Death_Tests">Death Tests</a></li><ul><li><a href="#How_to_Write_a_Death_Test">How to Write a Death Test</a></li><li><a href="#Regular_Expression_Syntax">Regular Expression Syntax</a></li><li><a href="#How_It_Works">How It Works</a></li><li><a href="#Death_Tests_And_Threads">Death Tests And Threads</a></li><li><a href="#Death_Test_Styles">Death Test Styles</a></li><li><a href="#Caveats">Caveats</a></li></ul><li><a href="#Using_Assertions_in_Sub-routines">Using Assertions in Sub-routines</a></li><ul><li><a href="#Adding_Traces_to_Assertions">Adding Traces to Assertions</a></li><li><a href="#Propagating_Fatal_Failures">Propagating Fatal Failures</a></li><ul><li><a href="#Asserting_on_Subroutines">Asserting on Subroutines</a></li><li><a href="#Checking_for_Failures_in_the_Current_Test">Checking for Failures in the Current Test</a></li></ul></ul><li><a href="#Logging_Additional_Information">Logging Additional Information</a></li><li><a href="#Sharing_Resources_Between_Tests_in_the_Same_Test_Case">Sharing Resources Between Tests in the Same Test Case</a></li><li><a href="#Global_Set-Up_and_Tear-Down">Global Set-Up and Tear-Down</a></li><li><a href="#Value_Parameterized_Tests">Value Parameterized Tests</a></li><ul><li><a href="#How_to_Write_Value-Parameterized_Tests">How to Write Value-Parameterized Tests</a></li><li><a href="#Creating_Value-Parameterized_Abstract_Tests">Creating Value-Parameterized Abstract Tests</a></li></ul><li><a href="#Typed_Tests">Typed Tests</a></li><li><a href="#Type-Parameterized_Tests">Type-Parameterized Tests</a></li><li><a href="#Testing_Private_Code">Testing Private Code</a></li><ul><li><a href="#Static_Functions">Static Functions</a></li><li><a href="#Private_Class_Members">Private Class Members</a></li></ul><li><a href="#Catching_Failures">Catching Failures</a></li><li><a href="#Getting_the_Current_Test%27s_Name">Getting the Current Test's Name</a></li><li><a href="#Extending_Google_Test_by_Handling_Test_Events">Extending Google Test by Handling Test Events</a></li><ul><li><a href="#Defining_Event_Listeners">Defining Event Listeners</a></li><li><a href="#Using_Event_Listeners">Using Event Listeners</a></li><li><a href="#Generating_Failures_in_Listeners">Generating Failures in Listeners</a></li></ul><li><a href="#Running_Test_Programs:_Advanced_Options">Running Test Programs: Advanced Options</a></li><ul><li><a href="#Selecting_Tests">Selecting Tests</a></li><ul><li><a href="#Listing_Test_Names">Listing Test Names</a></li><li><a href="#Running_a_Subset_of_the_Tests">Running a Subset of the Tests</a></li><li><a href="#Temporarily_Disabling_Tests">Temporarily Disabling Tests</a></li><li><a href="#Temporarily_Enabling_Disabled_Tests">Temporarily Enabling Disabled Tests</a></li></ul><li><a href="#Repeating_the_Tests">Repeating the Tests</a></li><li><a href="#Shuffling_the_Tests">Shuffling the Tests</a></li><li><a href="#Controlling_Test_Output">Controlling Test Output</a></li><ul><li><a href="#Colored_Terminal_Output">Colored Terminal Output</a></li><li><a href="#Suppressing_the_Elapsed_Time">Suppressing the Elapsed Time</a></li><li><a href="#Generating_an_XML_Report">Generating an XML Report</a></li></ul><li><a href="#Controlling_How_Failures_Are_Reported">Controlling How Failures Are Reported</a></li><ul><li><a href="#Turning_Assertion_Failures_into_Break-Points">Turning Assertion Failures into Break-Points</a></li><li><a href="#Suppressing_Pop-ups_Caused_by_Exceptions">Suppressing Pop-ups Caused by Exceptions</a></li><li><a href="#Letting_Another_Testing_Framework_Drive">Letting Another Testing Framework Drive</a></li></ul><li><a href="#Distributing_Test_Functions_to_Multiple_Machines">Distributing Test Functions to Multiple Machines</a></li></ul><li><a href="#Fusing_Google_Test_Source_Files">Fusing Google Test Source Files</a></li><li><a href="#Where_to_Go_from_Here">Where to Go from Here</a></li></ul> <p>Now that you have read <a href="http://code.google.com/p/googletest/wiki/GoogleTestPrimer">GoogleTestPrimer</a>
and learned how to write tests using Google Test, it's time to learn
some new tricks. This document will show you more assertions as well as
how to construct complex failure messages, propagate fatal failures,
reuse and speed up your test fixtures, and use various flags with your
tests. </p><h1><a name="More_Assertions">More Assertions</a></h1><p><a name="More_Assertions">This section covers some less frequently used, but still significant, assertions. </a></p><h2><a name="Explicit_Success_and_Failure">Explicit Success and Failure</a></h2><p><a name="Explicit_Success_and_Failure">These
three assertions do not actually test a value or expression. Instead,
they generate a success or failure directly. Like the macros that
actually perform a test, you may stream a custom failure message into
the them. </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>SUCCEED();</tt> </td></tr> </tbody></table><p><a name="Explicit_Success_and_Failure">Generates
a success. This does NOT make the overall test succeed. A test is
considered successful only if none of its assertions fail during its
execution. </a></p><p><a name="Explicit_Success_and_Failure">Note: <tt>SUCCEED()</tt> is purely documentary and currently doesn't generate any user-visible output. However, we may add <tt>SUCCEED()</tt> messages to Google Test's output in the future. </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>FAIL();</tt>  </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ADD_FAILURE();</tt> </td></tr> </tbody></table><p><a name="Explicit_Success_and_Failure"><tt>FAIL*</tt> generates a fatal failure while <tt>ADD_FAILURE*</tt>
generates a nonfatal failure. These are useful when control flow,
rather than a Boolean expression, deteremines the test's success or
failure. For example, you might want to write something like: </a></p><pre class="prettyprint"><a name="Explicit_Success_and_Failure"><span class="kwd">switch</span><span class="pun">(</span><span class="pln">expression</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> some checks </span><span class="pun">...</span><span class="pln"><br>&nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> some other checks<br>&nbsp; </span><span class="pun">...</span><span class="pln"><br>&nbsp; </span><span class="kwd">default</span><span class="pun">:</span><span class="pln"> FAIL</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"We shouldn't get here."</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Explicit_Success_and_Failure"><i>Availability</i>: Linux, Windows, Mac. </a></p><h2><a name="Exception_Assertions">Exception Assertions</a></h2><p><a name="Exception_Assertions">These are for verifying that a piece of code throws (or does not throw) an exception of the given type: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_THROW(</tt><i>statement</i>, <i>exception_type</i><tt>);</tt>  </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_THROW(</tt><i>statement</i>, <i>exception_type</i><tt>);</tt>  </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>statement</i> throws an exception of the given type  </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_ANY_THROW(</tt><i>statement</i><tt>);</tt>                </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_ANY_THROW(</tt><i>statement</i><tt>);</tt>                </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>statement</i> throws an exception of any type        </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_NO_THROW(</tt><i>statement</i><tt>);</tt>                 </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_NO_THROW(</tt><i>statement</i><tt>);</tt>                 </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>statement</i> doesn't throw any exception            </td></tr> </tbody></table><p><a name="Exception_Assertions">Examples: </a></p><pre class="prettyprint"><a name="Exception_Assertions"><span class="pln">ASSERT_THROW</span><span class="pun">(</span><span class="typ">Foo</span><span class="pun">(</span><span class="lit">5</span><span class="pun">),</span><span class="pln"> bar_exception</span><span class="pun">);</span><span class="pln"><br><br>EXPECT_NO_THROW</span><span class="pun">({</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="typ">Bar</span><span class="pun">(&amp;</span><span class="pln">n</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">});</span></a></pre><p><a name="Exception_Assertions"><i>Availability</i>: Linux, Windows, Mac; since version 1.1.0. </a></p><h2><a name="Predicate_Assertions_for_Better_Error_Messages">Predicate Assertions for Better Error Messages</a></h2><p><a name="Predicate_Assertions_for_Better_Error_Messages">Even
though Google Test has a rich set of assertions, they can never be
complete, as it's impossible (nor a good idea) to anticipate all the
scenarios a user might run into. Therefore, sometimes a user has to use
<tt>EXPECT_TRUE()</tt> to check a complex expression, for lack of a
better macro. This has the problem of not showing you the values of the
parts of the expression, making it hard to understand what went wrong.
As a workaround, some users choose to construct the failure message by
themselves, streaming it into <tt>EXPECT_TRUE()</tt>. However, this is awkward especially when the expression has side-effects or is expensive to evaluate. </a></p><p><a name="Predicate_Assertions_for_Better_Error_Messages">Google Test gives you three different options to solve this problem: </a></p><h3><a name="Using_an_Existing_Boolean_Function">Using an Existing Boolean Function</a></h3><p><a name="Using_an_Existing_Boolean_Function">If you already have a function or a functor that returns <tt>bool</tt> (or a type that can be implicitly converted to <tt>bool</tt>), you can use it in a <i>predicate assertion</i> to get the function arguments printed for free: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_PRED1(</tt><i>pred1, val1</i><tt>);</tt>       </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_PRED1(</tt><i>pred1, val1</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>pred1(val1)</i> returns true </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_PRED2(</tt><i>pred2, val1, val2</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_PRED2(</tt><i>pred2, val1, val2</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">  <i>pred2(val1, val2)</i> returns true </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">  ...  </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> ... </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> ... </td></tr> </tbody></table><p><a name="Using_an_Existing_Boolean_Function">In the above, <i>predn</i> is an <i>n</i>-ary predicate function or functor, where <i>val1</i>, <i>val2</i>, ..., and <i>valn</i> are its arguments. The assertion succeeds if the predicate returns <tt>true</tt>
when applied to the given arguments, and fails otherwise. When the
assertion fails, it prints the value of each argument. In either case,
the arguments are evaluated exactly once. </a></p><p><a name="Using_an_Existing_Boolean_Function">Here's an example. Given </a></p><pre class="prettyprint"><a name="Using_an_Existing_Boolean_Function"><span class="com">// Returns true iff m and n have no common divisors except 1.</span><span class="pln"><br></span><span class="kwd">bool</span><span class="pln"> </span><span class="typ">MutuallyPrime</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br></span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span></a></pre><p><a name="Using_an_Existing_Boolean_Function">the assertion <tt>EXPECT_PRED2(MutuallyPrime, a, b);</tt> will succeed, while the assertion <tt>EXPECT_PRED2(MutuallyPrime, b, c);</tt> will fail with the message </a></p><p></p><pre><a name="Using_an_Existing_Boolean_Function"> MutuallyPrime(b, c) is false, where
 b is 4
 c is 10
 </a></pre><a name="Using_an_Existing_Boolean_Function"> </a><p><a name="Using_an_Existing_Boolean_Function"><strong>Notes:</strong> </a></p><ol><li><a name="Using_an_Existing_Boolean_Function">If you see a compiler error "no matching function to call" when using <tt>ASSERT_PRED*</tt> or <tt>EXPECT_PRED*</tt>, please see </a><a href="http://code.google.com/p/googletest/wiki/GoogleTestFAQ#The_compiler_complains_%22no_matching_function_to_call%22">this</a> for how to resolve it. </li><li>Currently we only provide predicate assertions of arity &lt;= 5. If you need a higher-arity assertion, let us know. </li></ol><p><i>Availability</i>: Linux, Windows, Mac </p><h3><a name="Using_a_Function_That_Returns_an_AssertionResult">Using a Function That Returns an AssertionResult</a></h3><p><a name="Using_a_Function_That_Returns_an_AssertionResult">While <tt>EXPECT_PRED*()</tt>
and friends are handy for a quick job, the syntax is not satisfactory:
you have to use different macros for different arities, and it feels
more like Lisp than C++. The <tt>::testing::AssertionResult</tt> class solves this problem. </a></p><p><a name="Using_a_Function_That_Returns_an_AssertionResult">An <tt>AssertionResult</tt>
object represents the result of an assertion (whether it's a success or
a failure, and an associated message). You can create an <tt>AssertionResult</tt> using one of these factory functions: </a></p><pre class="prettyprint"><a name="Using_a_Function_That_Returns_an_AssertionResult"><span class="kwd">namespace</span><span class="pln"> testing </span><span class="pun">{</span><span class="pln"><br><br></span><span class="com">// Returns an AssertionResult object to indicate that an assertion has</span><span class="pln"><br></span><span class="com">// succeeded.</span><span class="pln"><br></span><span class="typ">AssertionResult</span><span class="pln"> </span><span class="typ">AssertionSuccess</span><span class="pun">();</span><span class="pln"><br><br></span><span class="com">// Returns an AssertionResult object to indicate that an assertion has</span><span class="pln"><br></span><span class="com">// failed.</span><span class="pln"><br></span><span class="typ">AssertionResult</span><span class="pln"> </span><span class="typ">AssertionFailure</span><span class="pun">();</span><span class="pln"><br><br></span><span class="pun">}</span></a></pre><p><a name="Using_a_Function_That_Returns_an_AssertionResult">You can then use the <tt>&lt;&lt;</tt> operator to stream messages to the <tt>AssertionResult</tt> object. </a></p><p><a name="Using_a_Function_That_Returns_an_AssertionResult">To provide more readable messages in Boolean assertions (e.g. <tt>EXPECT_TRUE()</tt>), write a predicate function that returns <tt>AssertionResult</tt> instead of <tt>bool</tt>. For example, if you define <tt>IsEven()</tt> as: </a></p><pre class="prettyprint"><a name="Using_a_Function_That_Returns_an_AssertionResult"><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionResult</span><span class="pln"> </span><span class="typ">IsEven</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionSuccess</span><span class="pun">();</span><span class="pln"><br>&nbsp; </span><span class="kwd">else</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionFailure</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" is odd"</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Using_a_Function_That_Returns_an_AssertionResult">instead of: </a></p><pre class="prettyprint"><a name="Using_a_Function_That_Returns_an_AssertionResult"><span class="kwd">bool</span><span class="pln"> </span><span class="typ">IsEven</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Using_a_Function_That_Returns_an_AssertionResult">the failed assertion <tt>EXPECT_TRUE(IsEven(Fib(4)))</tt> will print: </a></p><p></p><pre><a name="Using_a_Function_That_Returns_an_AssertionResult">   Value of: IsEven(Fib(4))
     Actual: false (<strong>3 is odd</strong>)
   Expected: true
 </a></pre><a name="Using_a_Function_That_Returns_an_AssertionResult"> </a><p><a name="Using_a_Function_That_Returns_an_AssertionResult">instead of a more opaque </a></p><p></p><pre><a name="Using_a_Function_That_Returns_an_AssertionResult">   Value of: IsEven(Fib(4))
     Actual: false
   Expected: true
 </a></pre><a name="Using_a_Function_That_Returns_an_AssertionResult">                                                                            If you want informative messages in <tt>EXPECT_FALSE</tt> and <tt>ASSERT_FALSE</tt> as well, and are fine with making the predicate slower in the success case, you can supply a success message: </a><pre class="prettyprint"><a name="Using_a_Function_That_Returns_an_AssertionResult"><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionResult</span><span class="pln"> </span><span class="typ">IsEven</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionSuccess</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" is even"</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="kwd">else</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionFailure</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" is odd"</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Using_a_Function_That_Returns_an_AssertionResult">Then the statement <tt>EXPECT_FALSE(IsEven(Fib(6)))</tt> will print </a></p><p></p><pre><a name="Using_a_Function_That_Returns_an_AssertionResult">   Value of: IsEven(Fib(6))
     Actual: true (8 is even)
   Expected: false
 </a></pre><a name="Using_a_Function_That_Returns_an_AssertionResult"> </a><p><a name="Using_a_Function_That_Returns_an_AssertionResult"><i>Availability</i>: Linux, Windows, Mac; since version 1.4.1. </a></p><h3><a name="Using_a_Predicate-Formatter">Using a Predicate-Formatter</a></h3><p><a name="Using_a_Predicate-Formatter">If you find the default message generated by <tt>(ASSERT|EXPECT)_PRED*</tt> and <tt>(ASSERT|EXPECT)_(TRUE|FALSE)</tt> unsatisfactory, or some arguments to your predicate do not support streaming to <tt>ostream</tt>, you can instead use the following <i>predicate-formatter assertions</i> to <i>fully</i> customize how the message is formatted: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_PRED_FORMAT1(</tt><i>pred_format1, val1</i><tt>);</tt>        </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_PRED_FORMAT1(</tt><i>pred_format1, val1</i>`); </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>pred_format1(val1)</i> is successful </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_PRED_FORMAT2(</tt><i>pred_format2, val1, val2</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_PRED_FORMAT2(</tt><i>pred_format2, val1, val2</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>pred_format2(val1, val2)</i> is successful </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>...</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>...</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>...</tt> </td></tr> </tbody></table><p><a name="Using_a_Predicate-Formatter">The difference between this and the previous two groups of macros is that instead of a predicate, <tt>(ASSERT|EXPECT)_PRED_FORMAT*</tt> take a <i>predicate-formatter</i> (<i>pred_formatn</i>), which is a function or functor with the signature: </a></p><p><a name="Using_a_Predicate-Formatter"><tt>::testing::AssertionResult PredicateFormattern(const char* </tt><i>expr1</i><tt>, const char* </tt><i>expr2</i><tt>, ... const char* </tt><i>exprn</i><tt>, T1 </tt><i>val1</i><tt>, T2 </tt><i>val2</i><tt>, ... Tn </tt><i>valn</i><tt>);</tt> </a></p><p><a name="Using_a_Predicate-Formatter">where <i>val1</i>, <i>val2</i>, ..., and <i>valn</i> are the values of the predicate arguments, and <i>expr1</i>, <i>expr2</i>, ..., and <i>exprn</i> are the corresponding expressions as they appear in the source code. The types <tt>T1</tt>, <tt>T2</tt>, ..., and <tt>Tn</tt> can be either value types or reference types. For example, if an argument has type <tt>Foo</tt>, you can declare it as either <tt>Foo</tt> or <tt>const Foo&amp;</tt>, whichever is appropriate. </a></p><p><a name="Using_a_Predicate-Formatter">A predicate-formatter returns a <tt>::testing::AssertionResult</tt>
object to indicate whether the assertion has succeeded or not. The only
way to create such an object is to call one of these factory functions:
</a></p><p><a name="Using_a_Predicate-Formatter">As an example, let's improve the failure message in the previous example, which uses <tt>EXPECT_PRED2()</tt>: </a></p><pre class="prettyprint"><a name="Using_a_Predicate-Formatter"><span class="com">// Returns the smallest prime common divisor of m and n,</span><span class="pln"><br></span><span class="com">// or 1 when m and n are mutually prime.</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> </span><span class="typ">SmallestPrimeCommonDivisor</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br><br></span><span class="com">// A predicate-formatter for asserting that two integers are mutually prime.</span><span class="pln"><br></span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionResult</span><span class="pln"> </span><span class="typ">AssertMutuallyPrime</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">*</span><span class="pln"> m_expr</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">*</span><span class="pln"> n_expr</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MutuallyPrime</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">))</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionSuccess</span><span class="pun">();</span><span class="pln"><br>&nbsp;<br>&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AssertionFailure</span><span class="pun">()</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="pun">&lt;&lt;</span><span class="pln"> m_expr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" and "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> n_expr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" ("</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> m </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" and "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> n<br>&nbsp; &nbsp; &nbsp; </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">") are not mutually prime, "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"as they have a common divisor "</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="typ">SmallestPrimeCommonDivisor</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Using_a_Predicate-Formatter">With this predicate-formatter, we can use </a></p><pre class="prettyprint"><a name="Using_a_Predicate-Formatter"><span class="pln">EXPECT_PRED_FORMAT2</span><span class="pun">(</span><span class="typ">AssertMutuallyPrime</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">);</span></a></pre><p><a name="Using_a_Predicate-Formatter">to generate the message </a></p><p></p><pre><a name="Using_a_Predicate-Formatter"> b and c (4 and 10) are not mutually prime, as they have a common divisor 2.
 </a></pre><a name="Using_a_Predicate-Formatter"> </a><p><a name="Using_a_Predicate-Formatter">As you may have realized, many of the assertions we introduced earlier are special cases of <tt>(EXPECT|ASSERT)_PRED_FORMAT*</tt>. In fact, most of them are indeed defined using <tt>(EXPECT|ASSERT)_PRED_FORMAT*</tt>. </a></p><p><a name="Using_a_Predicate-Formatter"><i>Availability</i>: Linux, Windows, Mac. </a></p><h2><a name="Floating-Point_Comparison">Floating-Point Comparison</a></h2><p><a name="Floating-Point_Comparison">Comparing
floating-point numbers is tricky. Due to round-off errors, it is very
unlikely that two floating-points will match exactly. Therefore, <tt>ASSERT_EQ</tt>
's naive comparison usually doesn't work. And since floating-points can
have a wide value range, no single fixed error bound works. It's better
to compare by a fixed relative error bound, except for values close to
0 due to the loss of precision there. </a></p><p><a name="Floating-Point_Comparison">In
general, for floating-point comparison to make sense, the user needs to
carefully choose the error bound. If they don't want or care to,
comparing in terms of Units in the Last Place (ULPs) is a good default,
and Google Test provides assertions to do this. Full details about ULPs
are quite long; if you want to learn more, see </a><a href="http://www.cygnus-software.com/papers/comparingfloats/comparingfloats.htm" rel="nofollow">this article on float comparison</a>. </p><h3><a name="Floating-Point_Macros">Floating-Point Macros</a></h3><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_FLOAT_EQ(</tt><i>expected, actual</i><tt>);</tt>  </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_FLOAT_EQ(</tt><i>expected, actual</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> the two <tt>float</tt> values are almost equal </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_DOUBLE_EQ(</tt><i>expected, actual</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_DOUBLE_EQ(</tt><i>expected, actual</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> the two <tt>double</tt> values are almost equal </td></tr> </tbody></table><p><a name="Floating-Point_Macros">By "almost equal", we mean the two values are within 4 ULP's from each other. </a></p><p><a name="Floating-Point_Macros">The following assertions allow you to choose the acceptable error bound: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_NEAR(</tt><i>val1, val2, abs_error</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_NEAR</tt><i>(val1, val2, abs_error</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> the difference between <i>val1</i> and <i>val2</i> doesn't exceed the given absolute error </td></tr> </tbody></table><p><a name="Floating-Point_Macros"><i>Availability</i>: Linux, Windows, Mac. </a></p><h3><a name="Floating-Point_Predicate-Format_Functions">Floating-Point Predicate-Format Functions</a></h3><p><a name="Floating-Point_Predicate-Format_Functions">Some
floating-point operations are useful, but not that often used. In order
to avoid an explosion of new macros, we provide them as
predicate-format functions that can be used in predicate assertion
macros (e.g. <tt>EXPECT_PRED_FORMAT2</tt>, etc). </a></p><pre class="prettyprint"><a name="Floating-Point_Predicate-Format_Functions"><span class="pln">EXPECT_PRED_FORMAT2</span><span class="pun">(::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">FloatLE</span><span class="pun">,</span><span class="pln"> val1</span><span class="pun">,</span><span class="pln"> val2</span><span class="pun">);</span><span class="pln"><br>EXPECT_PRED_FORMAT2</span><span class="pun">(::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">DoubleLE</span><span class="pun">,</span><span class="pln"> val1</span><span class="pun">,</span><span class="pln"> val2</span><span class="pun">);</span></a></pre><p><a name="Floating-Point_Predicate-Format_Functions">Verifies that <i>val1</i> is less than, or almost equal to, <i>val2</i>. You can replace <tt>EXPECT_PRED_FORMAT2</tt> in the above table with <tt>ASSERT_PRED_FORMAT2</tt>. </a></p><p><a name="Floating-Point_Predicate-Format_Functions"><i>Availability</i>: Linux, Windows, Mac. </a></p><h2><a name="Windows_HRESULT_assertions">Windows HRESULT assertions</a></h2><p><a name="Windows_HRESULT_assertions">These assertions test for <tt>HRESULT</tt> success or failure. </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_HRESULT_SUCCEEDED(</tt><i>expression</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_HRESULT_SUCCEEDED(</tt><i>expression</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>expression</i> is a success <tt>HRESULT</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_HRESULT_FAILED(</tt><i>expression</i><tt>);</tt>    </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_HRESULT_FAILED(</tt><i>expression</i><tt>);</tt>    </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>expression</i> is a failure <tt>HRESULT</tt> </td></tr> </tbody></table><p><a name="Windows_HRESULT_assertions">The generated output contains the human-readable error message associated with the <tt>HRESULT</tt> code returned by <i>expression</i>. </a></p><p><a name="Windows_HRESULT_assertions">You might use them like this: </a></p><pre class="prettyprint"><a name="Windows_HRESULT_assertions"><span class="typ">CComPtr</span><span class="pln"> shell</span><span class="pun">;</span><span class="pln"><br>ASSERT_HRESULT_SUCCEEDED</span><span class="pun">(</span><span class="pln">shell</span><span class="pun">.</span><span class="typ">CoCreateInstance</span><span class="pun">(</span><span class="pln">L</span><span class="str">"Shell.Application"</span><span class="pun">));</span><span class="pln"><br></span><span class="typ">CComVariant</span><span class="pln"> empty</span><span class="pun">;</span><span class="pln"><br>ASSERT_HRESULT_SUCCEEDED</span><span class="pun">(</span><span class="pln">shell</span><span class="pun">-&gt;</span><span class="typ">ShellExecute</span><span class="pun">(</span><span class="typ">CComBSTR</span><span class="pun">(</span><span class="pln">url</span><span class="pun">),</span><span class="pln"> empty</span><span class="pun">,</span><span class="pln"> empty</span><span class="pun">,</span><span class="pln"> empty</span><span class="pun">,</span><span class="pln"> empty</span><span class="pun">));</span></a></pre><p><a name="Windows_HRESULT_assertions"><i>Availability</i>: Windows. </a></p><h2><a name="Type_Assertions">Type Assertions</a></h2><p><a name="Type_Assertions">You can call the function </a></p><pre class="prettyprint"><a name="Type_Assertions"><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">StaticAssertTypeEq</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">,</span><span class="pln"> T2</span><span class="pun">&gt;();</span></a></pre><p><a name="Type_Assertions">to assert that types <tt>T1</tt> and <tt>T2</tt>
are the same. The function does nothing if the assertion is satisfied.
If the types are different, the function call will fail to compile, and
the compiler error message will likely (depending on the compiler) show
you the actual values of <tt>T1</tt> and <tt>T2</tt>.  This is mainly useful inside template code. </a></p><p><a name="Type_Assertions"><i>Caveat:</i> When used inside a member function of a class template or a function template, <tt>StaticAssertTypeEq&lt;T1, T2&gt;()</tt> is effective <i>only if</i> the function is instantiated.  For example, given: </a></p><pre class="prettyprint"><a name="Type_Assertions"><span class="kwd">template</span><span class="pln"> </span><span class="pun">&lt;</span><span class="kwd">typename</span><span class="pln"> T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp;</span><span class="kwd">public</span><span class="pun">:</span><span class="pln"><br>&nbsp; </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">StaticAssertTypeEq</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> T</span><span class="pun">&gt;();</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br></span><span class="pun">};</span></a></pre><p><a name="Type_Assertions">the code: </a></p><pre class="prettyprint"><a name="Type_Assertions"><span class="kwd">void</span><span class="pln"> </span><span class="typ">Test1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Foo</span><span class="str">&lt;bool&gt;</span><span class="pln"> foo</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span></a></pre><p><a name="Type_Assertions">will <i>not</i> generate a compiler error, as <tt>Foo&lt;bool&gt;::Bar()</tt> is never actually instantiated.  Instead, you need: </a></p><pre class="prettyprint"><a name="Type_Assertions"><span class="kwd">void</span><span class="pln"> </span><span class="typ">Test2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Foo</span><span class="str">&lt;bool&gt;</span><span class="pln"> foo</span><span class="pun">;</span><span class="pln"> foo</span><span class="pun">.</span><span class="typ">Bar</span><span class="pun">();</span><span class="pln"> </span><span class="pun">}</span></a></pre><p><a name="Type_Assertions">to cause a compiler error. </a></p><p><a name="Type_Assertions"><i>Availability:</i> Linux, Windows, Mac; since version 1.3.0. </a></p><h2><a name="Assertion_Placement">Assertion Placement</a></h2><p><a name="Assertion_Placement">You
can use assertions in any C++ function. In particular, it doesn't have
to be a method of the test fixture class. The one constraint is that
assertions that generate a fatal failure (<tt>FAIL*</tt> and <tt>ASSERT_*</tt>)
can only be used in void-returning functions. This is a consequence of
Google Test not using exceptions. By placing it in a non-void function
you'll get a confusing compile error like <tt>"error: void value not ignored as it ought to be"</tt>. </a></p><p><a name="Assertion_Placement">If
you need to use assertions in a function that returns non-void, one
option is to make the function return the value in an out parameter
instead. For example, you can rewrite <tt>T2 Foo(T1 x)</tt> to <tt>void Foo(T1 x, T2* result)</tt>. You need to make sure that <tt>*result</tt> contains some sensible value even when the function returns prematurely. As the function now returns <tt>void</tt>, you can use any assertion inside of it. </a></p><p><a name="Assertion_Placement">If changing the function's type is not an option, you should just use assertions that generate non-fatal failures, such as <tt>ADD_FAILURE*</tt> and <tt>EXPECT_*</tt>. </a></p><p><a name="Assertion_Placement"><i>Note</i>:
Constructors and destructors are not considered void-returning
functions, according to the C++ language specification, and so you may
not use fatal assertions in them. You'll get a compilation error if you
try. A simple workaround is to transfer the entire body of the
constructor or destructor to a private void-returning method. However,
you should be aware that a fatal assertion failure in a constructor
does not terminate the current test, as your intuition might suggest;
it merely returns from the constructor early, possibly leaving your
object in a partially-constructed state. Likewise, a fatal assertion
failure in a destructor may leave your object in a partially-destructed
state. Use assertions carefully in these situations! </a></p><h1><a name="Death_Tests">Death Tests</a></h1><p><a name="Death_Tests">In
many applications, there are assertions that can cause application
failure if a condition is not met. These sanity checks, which ensure
that the program is in a known good state, are there to fail at the
earliest possible time after some program state is corrupted. If the
assertion checks the wrong condition, then the program may proceed in
an erroneous state, which could lead to memory corruption, security
holes, or worse. Hence it is vitally important to test that such
assertion statements work as expected. </a></p><p><a name="Death_Tests">Since these precondition checks cause the processes to die, we call such tests <i>death tests</i>. More generally, any test that checks that a program terminates in an expected fashion is also a death test. </a></p><p><a name="Death_Tests">If you want to test <tt>EXPECT_*()/ASSERT_*()</tt> failures in your test code, see </a><a href="#Catching_Failures">Catching Failures</a>.  </p><h2><a name="How_to_Write_a_Death_Test">How to Write a Death Test</a></h2><p><a name="How_to_Write_a_Death_Test">Google Test has the following macros to support death tests: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_DEATH(</tt><i>statement, regex</i>`); </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_DEATH(</tt><i>statement, regex</i>`); </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>statement</i> crashes with the given error </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_DEATH_IF_SUPPORTED(</tt><i>statement, regex</i>`); </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_DEATH_IF_SUPPORTED(</tt><i>statement, regex</i>`); </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> if death tests are supported, verifies that <i>statement</i> crashes with the given error; otherwise verifies nothing </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_EXIT(</tt><i>statement, predicate, regex</i>`); </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_EXIT(</tt><i>statement, predicate, regex</i>`); </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"><i>statement</i> exits with the given error and its exit code matches <i>predicate</i> </td></tr> </tbody></table><p><a name="How_to_Write_a_Death_Test">where <i>statement</i> is a statement that is expected to cause the process to die, <i>predicate</i> is a function or function object that evaluates an integer exit status, and <i>regex</i> is a regular expression that the stderr output of <i>statement</i> is expected to match. Note that <i>statement</i> can be <i>any valid statement</i> (including <i>compound statement</i>) and doesn't have to be an expression. </a></p><p><a name="How_to_Write_a_Death_Test">As usual, the <tt>ASSERT</tt> variants abort the current test function, while the <tt>EXPECT</tt> variants do not. </a></p><p><a name="How_to_Write_a_Death_Test"><strong>Note:</strong> We use the word "crash" here to mean that the process terminates with a <i>non-zero</i> exit status code.  There are two possibilities: either the process has called <tt>exit()</tt> or <tt>_exit()</tt> with a non-zero value, or it may be killed by a signal. </a></p><p><a name="How_to_Write_a_Death_Test">This means that if <i>statement</i> terminates the process with a 0 exit code, it is <i>not</i> considered a crash by <tt>EXPECT_DEATH</tt>.  Use <tt>EXPECT_EXIT</tt> instead if this is the case, or if you want to restrict the exit code more precisely. </a></p><p><a name="How_to_Write_a_Death_Test">A predicate here must accept an <tt>int</tt> and return a <tt>bool</tt>. The death test succeeds only if the predicate returns <tt>true</tt>. Google Test defines a few predicates that handle the most common cases: </a></p><pre class="prettyprint"><a name="How_to_Write_a_Death_Test"><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">ExitedWithCode</span><span class="pun">(</span><span class="pln">exit_code</span><span class="pun">)</span></a></pre><p><a name="How_to_Write_a_Death_Test">This expression is <tt>true</tt> if the program exited normally with the given exit code. </a></p><pre class="prettyprint"><a name="How_to_Write_a_Death_Test"><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">KilledBySignal</span><span class="pun">(</span><span class="pln">signal_number</span><span class="pun">)</span><span class="pln"> &nbsp;</span><span class="com">// Not available on Windows.</span></a></pre><p><a name="How_to_Write_a_Death_Test">This expression is <tt>true</tt> if the program was killed by the given signal. </a></p><p><a name="How_to_Write_a_Death_Test">The <tt>*_DEATH</tt> macros are convenient wrappers for <tt>*_EXIT</tt> that use a predicate that verifies the process' exit code is non-zero. </a></p><p><a name="How_to_Write_a_Death_Test">Note that a death test only cares about three things: </a></p><ol><li><a name="How_to_Write_a_Death_Test">does <i>statement</i> abort or exit the process? </a></li><li><a name="How_to_Write_a_Death_Test">(in the case of <tt>ASSERT_EXIT</tt> and <tt>EXPECT_EXIT</tt>) does the exit status satisfy <i>predicate</i>?  Or (in the case of <tt>ASSERT_DEATH</tt> and <tt>EXPECT_DEATH</tt>) is the exit status non-zero?  And </a></li><li><a name="How_to_Write_a_Death_Test">does the stderr output match <i>regex</i>? </a></li></ol><p><a name="How_to_Write_a_Death_Test">In particular, if <i>statement</i> generates an <tt>ASSERT_*</tt> or <tt>EXPECT_*</tt> failure, it will <strong>not</strong> cause the death test to fail, as Google Test assertions don't abort the process. </a></p><p><a name="How_to_Write_a_Death_Test">To write a death test, simply use one of the above macros inside your test function. For example, </a></p><pre class="prettyprint"><a name="How_to_Write_a_Death_Test"><span class="pln">TEST</span><span class="pun">(</span><span class="typ">My</span><span class="pun">*</span><span class="typ">DeathTest</span><span class="pun">*,</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// This death test uses a compound statement.</span><span class="pln"><br>&nbsp; ASSERT_DEATH</span><span class="pun">({</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">(&amp;</span><span class="pln">n</span><span class="pun">);</span><span class="pln"> </span><span class="pun">},</span><span class="pln"> </span><span class="str">"Error on line .* of Foo()"</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="typ">MyDeathTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">NormalExit</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; EXPECT_EXIT</span><span class="pun">(</span><span class="typ">NormalExit</span><span class="pun">(),</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">ExitedWithCode</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> </span><span class="str">"Success"</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="typ">MyDeathTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">KillMyself</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; EXPECT_EXIT</span><span class="pun">(</span><span class="typ">KillMyself</span><span class="pun">(),</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">KilledBySignal</span><span class="pun">(</span><span class="pln">SIGKILL</span><span class="pun">),</span><span class="pln"> </span><span class="str">"Sending myself unblockable signal"</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="How_to_Write_a_Death_Test">verifies that: </a></p><ul><li><a name="How_to_Write_a_Death_Test">calling <tt>Foo(5)</tt> causes the process to die with the given error message, </a></li><li><a name="How_to_Write_a_Death_Test">calling <tt>NormalExit()</tt> causes the process to print <tt>"Success"</tt> to stderr and exit with exit code 0, and </a></li><li><a name="How_to_Write_a_Death_Test">calling <tt>KillMyself()</tt> kills the process with signal <tt>SIGKILL</tt>. </a></li></ul><p><a name="How_to_Write_a_Death_Test">The test function body may contain other assertions and statements as well, if necessary. </a></p><p><a name="How_to_Write_a_Death_Test"><i>Important:</i> We strongly recommend you to follow the convention of naming your test case (not test) <tt>*DeathTest</tt> when it contains a death test, as demonstrated in the above example. The <tt>Death Tests And Threads</tt> section below explains why. </a></p><p><a name="How_to_Write_a_Death_Test">If
a test fixture class is shared by normal tests and death tests, you can
use typedef to introduce an alias for the fixture class and avoid
duplicating its code: </a></p><pre class="prettyprint"><a name="How_to_Write_a_Death_Test"><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Test</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">};</span><span class="pln"><br><br></span><span class="kwd">typedef</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pln"> </span><span class="typ">FooDeathTest</span><span class="pun">;</span><span class="pln"><br><br>TEST_F</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DoesThis</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// normal test</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br>TEST_F</span><span class="pun">(</span><span class="typ">FooDeathTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DoesThat</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// death test</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="How_to_Write_a_Death_Test"><i>Availability:</i> Linux, Windows (requires MSVC 8.0 or above), Cygwin, and Mac (the latter three are supported since v1.3.0).  <tt>(ASSERT|EXPECT)_DEATH_IF_SUPPORTED</tt> are new in v1.4.0. </a></p><h2><a name="Regular_Expression_Syntax">Regular Expression Syntax</a></h2><p><a name="Regular_Expression_Syntax">On POSIX systems (e.g. Linux, Cygwin, and Mac), Google Test uses the </a><a href="http://www.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap09.html#tag_09_04" rel="nofollow">POSIX extended regular expression</a> syntax in death tests. To learn about this syntax, you may want to read this <a href="http://en.wikipedia.org/wiki/Regular_expression#POSIX_Extended_Regular_Expressions" rel="nofollow">Wikipedia entry</a>.  </p><p>On
Windows, Google Test uses its own simple regular expression
implementation. It lacks many features you can find in POSIX extended
regular expressions. For example, we don't support union (<tt>"x|y"</tt>), grouping (<tt>"(xy)"</tt>), brackets (<tt>"[xy]"</tt>), and repetition count (<tt>"x{5,7}"</tt>), among others. Below is what we do support (<tt>A</tt> denotes a literal character, period (<tt>.</tt>), or a single <tt>\\</tt> escape sequence; <tt>x</tt> and <tt>y</tt> denote regular expressions.): </p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>c</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any literal character <tt>c</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\d</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any decimal digit </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\D</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any character that's not a decimal digit </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\f</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches <tt>\f</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\n</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches <tt>\n</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\r</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches <tt>\r</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\s</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any ASCII whitespace, including <tt>\n</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\S</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any character that's not a whitespace </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\t</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches <tt>\t</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\v</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches <tt>\v</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\w</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any letter, <tt>_</tt>, or decimal digit </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\W</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any character that <tt>\\w</tt> doesn't match </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>\\c</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any literal character <tt>c</tt>, which must be a punctuation </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>.</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches any single character except <tt>\n</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>A?</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches 0 or 1 occurrences of <tt>A</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>A*</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches 0 or many occurrences of <tt>A</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>A+</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches 1 or many occurrences of <tt>A</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>^</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches the beginning of a string (not that of each line) </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>$</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches the end of a string (not that of each line) </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>xy</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> matches <tt>x</tt> followed by <tt>y</tt> </td></tr> </tbody></table><p>To help you determine which capability is available on your system, Google Test defines macro <tt>GTEST_USES_POSIX_RE=1</tt> when it uses POSIX extended regular expressions, or <tt>GTEST_USES_SIMPLE_RE=1</tt> when it uses the simple version.  If you want your death tests to work in both cases, you can either <tt>#if</tt> on these macros or use the more limited syntax only. </p><h2><a name="How_It_Works">How It Works</a></h2><p><a name="How_It_Works">Under the hood, <tt>ASSERT_EXIT()</tt>
spawns a new process and executes the death test statement in that
process. The details of of how precisely that happens depend on the
platform and the variable <tt>::testing::GTEST_FLAG(death_test_style)</tt> (which is initialized from the command-line flag <tt>--gtest_death_test_style</tt>). </a></p><ul><li><a name="How_It_Works">On POSIX systems, <tt>fork()</tt> (or <tt>clone()</tt> on Linux) is used to spawn the child, after which: </a></li><ul><li><a name="How_It_Works">If the variable's value is <tt>"fast"</tt>, the death test statement is immediately executed. </a></li><li><a name="How_It_Works">If the variable's value is <tt>"threadsafe"</tt>,
the child process re-executes the unit test binary just as it was
originally invoked, but with some extra flags to cause just the single
death test under consideration to be run. </a></li></ul><li><a name="How_It_Works">On Windows, the child is spawned using the <tt>CreateProcess()</tt> API, and re-executes the binary to cause just the single death test under consideration to be run - much like the <tt>threadsafe</tt> mode on POSIX. </a></li></ul><p><a name="How_It_Works">Other values for the variable are illegal and will cause the death test to fail. Currently, the flag's default value is <tt>"fast"</tt>. However, we reserve the right to change it in the future. Therefore, your tests should not depend on this. </a></p><p><a name="How_It_Works">In either case, the parent process waits for the child process to complete, and checks that </a></p><ol><li><a name="How_It_Works"> the child's exit status satisfies the predicate, and </a></li><li><a name="How_It_Works"> the child's stderr matches the regular expression. </a></li></ol><p><a name="How_It_Works">If
the death test statement runs to completion without dying, the child
process will nonetheless terminate, and the assertion fails. </a></p><h2><a name="Death_Tests_And_Threads">Death Tests And Threads</a></h2><p><a name="Death_Tests_And_Threads">The
reason for the two death test styles has to do with thread safety. Due
to well-known problems with forking in the presence of threads, death
tests should be run in a single-threaded context. Sometimes, however,
it isn't feasible to arrange that kind of environment. For example,
statically-initialized modules may start threads before main is ever
reached. Once threads have been created, it may be difficult or
impossible to clean them up. </a></p><p><a name="Death_Tests_And_Threads">Google Test has three features intended to raise awareness of threading issues. </a></p><ol><li><a name="Death_Tests_And_Threads">A warning is emitted if multiple threads are running when a death test is encountered. </a></li><li><a name="Death_Tests_And_Threads">Test cases with a name ending in "DeathTest" are run before all other tests. </a></li><li><a name="Death_Tests_And_Threads">It uses <tt>clone()</tt> instead of <tt>fork()</tt> to spawn the child process on Linux (<tt>clone()</tt> is not available on Cygwin and Mac), as <tt>fork()</tt> is more likely to cause the child to hang when the parent process has multiple threads. </a></li></ol><p><a name="Death_Tests_And_Threads">It's
perfectly fine to create threads inside a death test statement; they
are executed in a separate process and cannot affect the parent. </a></p><h2><a name="Death_Test_Styles">Death Test Styles</a></h2><p><a name="Death_Test_Styles">The
"threadsafe" death test style was introduced in order to help mitigate
the risks of testing in a possibly multithreaded environment. It trades
increased test execution time (potentially dramatically so) for
improved thread safety. We suggest using the faster, default "fast"
style unless your test has specific problems with it. </a></p><p><a name="Death_Test_Styles">You can choose a particular style of death tests by setting the flag programmatically: </a></p><pre class="prettyprint"><a name="Death_Test_Styles"><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="pln">FLAGS_gtest_death_test_style </span><span class="pun">=</span><span class="pln"> </span><span class="str">"threadsafe"</span><span class="pun">;</span></a></pre><p><a name="Death_Test_Styles">You can do this in <tt>main()</tt>
to set the style for all death tests in the binary, or in individual
tests. Recall that flags are saved before running each test and
restored afterwards, so you need not do that yourself. For example: </a></p><pre class="prettyprint"><a name="Death_Test_Styles"><span class="pln">TEST</span><span class="pun">(</span><span class="typ">MyDeathTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TestOne</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="pln">FLAGS_gtest_death_test_style </span><span class="pun">=</span><span class="pln"> </span><span class="str">"threadsafe"</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="com">// This test is run in the "threadsafe" style:</span><span class="pln"><br>&nbsp; ASSERT_DEATH</span><span class="pun">(</span><span class="typ">ThisShouldDie</span><span class="pun">(),</span><span class="pln"> </span><span class="str">""</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br>TEST</span><span class="pun">(</span><span class="typ">MyDeathTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TestTwo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// This test is run in the "fast" style:</span><span class="pln"><br>&nbsp; ASSERT_DEATH</span><span class="pun">(</span><span class="typ">ThisShouldDie</span><span class="pun">(),</span><span class="pln"> </span><span class="str">""</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br></span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">**</span><span class="pln"> argv</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">InitGoogleTest</span><span class="pun">(&amp;</span><span class="pln">argc</span><span class="pun">,</span><span class="pln"> argv</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="pln">FLAGS_gtest_death_test_style </span><span class="pun">=</span><span class="pln"> </span><span class="str">"fast"</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> RUN_ALL_TESTS</span><span class="pun">();</span><span class="pln"><br></span><span class="pun">}</span></a></pre><h2><a name="Caveats">Caveats</a></h2><p><a name="Caveats">The <i>statement</i> argument of <tt>ASSERT_EXIT()</tt> can be any valid C++ statement except that it can not return from the current function. This means <i>statement</i> should not contain <tt>return</tt> or a macro that might return (e.g. <tt>ASSERT_TRUE()</tt> ). If <i>statement</i> returns before it crashes, Google Test will print an error message, and the test will fail. </a></p><p><a name="Caveats">Since <i>statement</i> runs in the child process, any in-memory side effect (e.g. modifying a variable, releasing memory, etc) it causes will <i>not</i>
be observable in the parent process. In particular, if you release
memory in a death test, your program will fail the heap check as the
parent process will never see the memory reclaimed. To solve this
problem, you can </a></p><ol><li><a name="Caveats"> try not to free memory in a death test; </a></li><li><a name="Caveats"> free the memory again in the parent process; or </a></li><li><a name="Caveats"> do not use the heap checker in your program. </a></li></ol><p><a name="Caveats">Due
to an implementation detail, you cannot place multiple death test
assertions on the same line; otherwise, compilation will fail with an
unobvious error message. </a></p><p><a name="Caveats">Despite the
improved thread safety afforded by the "threadsafe" style of death
test, thread problems such as deadlock are still possible in the
presence of handlers registered with <tt>pthread_atfork(3)</tt>. </a></p><h1><a name="Using_Assertions_in_Sub-routines">Using Assertions in Sub-routines</a></h1><h2><a name="Adding_Traces_to_Assertions">Adding Traces to Assertions</a></h2><p><a name="Adding_Traces_to_Assertions">If
a test sub-routine is called from several places, when an assertion
inside it fails, it can be hard to tell which invocation of the
sub-routine the failure is from. You can alleviate this problem using
extra logging or custom failure messages, but that usually clutters up
your tests. A better solution is to use the <tt>SCOPED_TRACE</tt> macro: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>SCOPED_TRACE(</tt><i>message</i><tt>);</tt> </td></tr> </tbody></table><p><a name="Adding_Traces_to_Assertions">where <i>message</i> can be anything streamable to <tt>std::ostream</tt>.
This macro will cause the current file name, line number, and the given
message to be added in every failure message. The effect will be undone
when the control leaves the current lexical scope. </a></p><p><a name="Adding_Traces_to_Assertions">For example, </a></p><pre class="prettyprint"><a name="Adding_Traces_to_Assertions"><span class="lit">10</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Sub1</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br></span><span class="lit">11</span><span class="pun">:</span><span class="pln"> &nbsp; EXPECT_EQ</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">(</span><span class="pln">n</span><span class="pun">));</span><span class="pln"><br></span><span class="lit">12</span><span class="pun">:</span><span class="pln"> &nbsp; EXPECT_EQ</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln"><br></span><span class="lit">13</span><span class="pun">:</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br></span><span class="lit">14</span><span class="pun">:</span><span class="pln"> <br></span><span class="lit">15</span><span class="pun">:</span><span class="pln"> TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br></span><span class="lit">16</span><span class="pun">:</span><span class="pln"> &nbsp; </span><span class="pun">{</span><span class="pln"><br></span><span class="lit">17</span><span class="pun">:</span><span class="pln"> &nbsp; &nbsp; SCOPED_TRACE</span><span class="pun">(</span><span class="str">"A"</span><span class="pun">);</span><span class="pln"> &nbsp;</span><span class="com">// This trace point will be included in</span><span class="pln"><br></span><span class="lit">18</span><span class="pun">:</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// every failure in this scope.</span><span class="pln"><br></span><span class="lit">19</span><span class="pun">:</span><span class="pln"> &nbsp; &nbsp; </span><span class="typ">Sub1</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln"><br></span><span class="lit">20</span><span class="pun">:</span><span class="pln"> &nbsp; </span><span class="pun">}</span><span class="pln"><br></span><span class="lit">21</span><span class="pun">:</span><span class="pln"> &nbsp; </span><span class="com">// Now it won't.</span><span class="pln"><br></span><span class="lit">22</span><span class="pun">:</span><span class="pln"> &nbsp; </span><span class="typ">Sub1</span><span class="pun">(</span><span class="lit">9</span><span class="pun">);</span><span class="pln"><br></span><span class="lit">23</span><span class="pun">:</span><span class="pln"> </span><span class="pun">}</span></a></pre><p><a name="Adding_Traces_to_Assertions">could result in messages like these: </a></p><pre class="prettyprint"><a name="Adding_Traces_to_Assertions"><span class="pln">path</span><span class="pun">/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">foo_test</span><span class="pun">.</span><span class="pln">cc</span><span class="pun">:</span><span class="lit">11</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Failure</span><span class="pln"><br></span><span class="typ">Value</span><span class="pln"> of</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"><br></span><span class="typ">Expected</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"><br>&nbsp; </span><span class="typ">Actual</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="typ">Trace</span><span class="pun">:</span><span class="pln"><br>path</span><span class="pun">/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">foo_test</span><span class="pun">.</span><span class="pln">cc</span><span class="pun">:</span><span class="lit">17</span><span class="pun">:</span><span class="pln"> A<br><br>path</span><span class="pun">/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">foo_test</span><span class="pun">.</span><span class="pln">cc</span><span class="pun">:</span><span class="lit">12</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Failure</span><span class="pln"><br></span><span class="typ">Value</span><span class="pln"> of</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"><br></span><span class="typ">Expected</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pln"><br>&nbsp; </span><span class="typ">Actual</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span></a></pre><p><a name="Adding_Traces_to_Assertions">Without the trace, it would've been difficult to know which invocation of <tt>Sub1()</tt> the two failures come from respectively. (You could add an extra message to each assertion in <tt>Sub1()</tt> to indicate the value of <tt>n</tt>, but that's tedious.) </a></p><p><a name="Adding_Traces_to_Assertions">Some tips on using <tt>SCOPED_TRACE</tt>: </a></p><ol><li><a name="Adding_Traces_to_Assertions">With a suitable message, it's often enough to use <tt>SCOPED_TRACE</tt> at the beginning of a sub-routine, instead of at each call site. </a></li><li><a name="Adding_Traces_to_Assertions">When calling sub-routines inside a loop, make the loop iterator part of the message in <tt>SCOPED_TRACE</tt> such that you can know which iteration the failure is from. </a></li><li><a name="Adding_Traces_to_Assertions">Sometimes
the line number of the trace point is enough for identifying the
particular invocation of a sub-routine. In this case, you don't have to
choose a unique message for <tt>SCOPED_TRACE</tt>. You can simply use <tt>""</tt>. </a></li><li><a name="Adding_Traces_to_Assertions">You can use <tt>SCOPED_TRACE</tt>
in an inner scope when there is one in the outer scope. In this case,
all active trace points will be included in the failure messages, in
reverse order they are encountered. </a></li><li><a name="Adding_Traces_to_Assertions">The
trace dump is clickable in Emacs' compilation buffer - hit return on a
line number and you'll be taken to that line in the source file! </a></li></ol><p><a name="Adding_Traces_to_Assertions"><i>Availability:</i> Linux, Windows, Mac. </a></p><h2><a name="Propagating_Fatal_Failures">Propagating Fatal Failures</a></h2><p><a name="Propagating_Fatal_Failures">A common pitfall when using <tt>ASSERT_*</tt> and <tt>FAIL*</tt> is not understanding that when they fail they only abort the <i>current function</i>, not the entire test. For example, the following test will segfault: </a></p><pre class="prettyprint"><a name="Propagating_Fatal_Failures"><span class="kwd">void</span><span class="pln"> </span><span class="typ">Subroutine</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// Generates a fatal failure and aborts the current function.</span><span class="pln"><br>&nbsp; ASSERT_EQ</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="com">// The following won't be executed.</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br>TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="typ">Subroutine</span><span class="pun">();</span><span class="pln"><br>&nbsp; </span><span class="com">// The intended behavior is for the fatal failure</span><span class="pln"><br>&nbsp; </span><span class="com">// in Subroutine() to abort the entire test.</span><span class="pln"><br>&nbsp; </span><span class="com">// The actual behavior: the function goes on after Subroutine() returns.</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pun">*</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">*</span><span class="pln">p </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> </span><span class="com">// Segfault!</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Propagating_Fatal_Failures">Since
we don't use exceptions, it is technically impossible to implement the
intended behavior here. To alleviate this, Google Test provides two
solutions. You could use either the <tt>(ASSERT|EXPECT)_NO_FATAL_FAILURE</tt> assertions or the <tt>HasFatalFailure()</tt> function.  They are described in the following two subsections. </a></p><h3><a name="Asserting_on_Subroutines">Asserting on Subroutines</a></h3><p><a name="Asserting_on_Subroutines">As shown above, if your test calls a subroutine that has an <tt>ASSERT_*</tt> failure in it, the test will continue after the subroutine returns. This may not be what you want. </a></p><p><a name="Asserting_on_Subroutines">Often people want fatal failures to propagate like exceptions.  For that Google Test offers the following macros: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Fatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Nonfatal assertion</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Verifies</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ASSERT_NO_FATAL_FAILURE(</tt><i>statement</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_NO_FATAL_FAILURE(</tt><i>statement</i><tt>);</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <i>statement</i> doesn't generate any new fatal failures in the current thread. </td></tr> </tbody></table><p><a name="Asserting_on_Subroutines">Only failures in the thread that executes the assertion are checked to determine the result of this type of assertions.  If <i>statement</i> creates new threads, failures in these threads are ignored. </a></p><p><a name="Asserting_on_Subroutines">Examples: </a></p><pre class="prettyprint"><a name="Asserting_on_Subroutines"><span class="pln">ASSERT_NO_FATAL_FAILURE</span><span class="pun">(</span><span class="typ">Foo</span><span class="pun">());</span><span class="pln"><br><br></span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"><br>EXPECT_NO_FATAL_FAILURE</span><span class="pun">({</span><span class="pln"><br>&nbsp; i </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">();</span><span class="pln"><br></span><span class="pun">});</span></a></pre><p><a name="Asserting_on_Subroutines"><i>Availability:</i> Linux, Windows, Mac. Assertions from multiple threads are currently not supported. </a></p><h3><a name="Checking_for_Failures_in_the_Current_Test">Checking for Failures in the Current Test</a></h3><p><a name="Checking_for_Failures_in_the_Current_Test"><tt>HasFatalFailure()</tt> in the <tt>::testing::Test</tt> class returns <tt>true</tt>
if an assertion in the current test has suffered a fatal failure. This
allows functions to catch fatal failures in a sub-routine and return
early. </a></p><pre class="prettyprint"><a name="Checking_for_Failures_in_the_Current_Test"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Test</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp;</span><span class="kwd">public</span><span class="pun">:</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br>&nbsp; </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="typ">HasFatalFailure</span><span class="pun">();</span><span class="pln"><br></span><span class="pun">};</span></a></pre><p><a name="Checking_for_Failures_in_the_Current_Test">The typical usage, which basically simulates the behavior of a thrown exception, is: </a></p><pre class="prettyprint"><a name="Checking_for_Failures_in_the_Current_Test"><span class="pln">TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="typ">Subroutine</span><span class="pun">();</span><span class="pln"><br>&nbsp; </span><span class="com">// Aborts if Subroutine() had a fatal failure.</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">HasFatalFailure</span><span class="pun">())</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="com">// The following won't be executed.</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Checking_for_Failures_in_the_Current_Test">If <tt>HasFatalFailure()</tt> is used outside of <tt>TEST()</tt> , <tt>TEST_F()</tt> , or a test fixture, you must add the <tt>::testing::Test::</tt> prefix, as in: </a></p><pre class="prettyprint"><a name="Checking_for_Failures_in_the_Current_Test"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Test</span><span class="pun">::</span><span class="typ">HasFatalFailure</span><span class="pun">())</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pun">;</span></a></pre><p><a name="Checking_for_Failures_in_the_Current_Test">Similarly, <tt>HasNonfatalFailure()</tt> returns <tt>true</tt> if the current test has at least one non-fatal failure, and <tt>HasFailure()</tt> returns <tt>true</tt> if the current test has at least one failure of either kind. </a></p><p><a name="Checking_for_Failures_in_the_Current_Test"><i>Availability:</i> Linux, Windows, Mac.  <tt>HasNonfatalFailure()</tt> and <tt>HasFailure()</tt> are available since version 1.4.0. </a></p><h1><a name="Logging_Additional_Information">Logging Additional Information</a></h1><p><a name="Logging_Additional_Information">In your test code, you can call <tt>RecordProperty("key", value)</tt> to log additional information, where <tt>value</tt> can be either a C string or a 32-bit integer. The <i>last</i> value recorded for a key will be emitted to the XML output if you specify one. For example, the test </a></p><pre class="prettyprint"><a name="Logging_Additional_Information"><span class="pln">TEST_F</span><span class="pun">(</span><span class="typ">WidgetUsageTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MinAndMaxWidgets</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="typ">RecordProperty</span><span class="pun">(</span><span class="str">"MaximumWidgets"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ComputeMaxUsage</span><span class="pun">());</span><span class="pln"><br>&nbsp; </span><span class="typ">RecordProperty</span><span class="pun">(</span><span class="str">"MinimumWidgets"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ComputeMinUsage</span><span class="pun">());</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Logging_Additional_Information">will output XML like this: </a></p><pre class="prettyprint"><a name="Logging_Additional_Information"><span class="pun">...</span><span class="pln"><br>&nbsp; </span><span class="pun">&lt;</span><span class="pln">testcase name</span><span class="pun">=</span><span class="str">"MinAndMaxWidgets"</span><span class="pln"> status</span><span class="pun">=</span><span class="str">"run"</span><span class="pln"> time</span><span class="pun">=</span><span class="str">"6"</span><span class="pln"> classname</span><span class="pun">=</span><span class="str">"WidgetUsageTest"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">MaximumWidgets</span><span class="pun">=</span><span class="str">"12"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">MinimumWidgets</span><span class="pun">=</span><span class="str">"9"</span><span class="pln"> </span><span class="pun">/&gt;</span><span class="pln"><br></span><span class="pun">...</span></a></pre><p><a name="Logging_Additional_Information"><i>Note</i>: </a></p><ul><li><a name="Logging_Additional_Information"> <tt>RecordProperty()</tt> is a static member of the <tt>Test</tt> class. Therefore it needs to be prefixed with <tt>::testing::Test::</tt> if used outside of the <tt>TEST</tt> body and the test fixture class. </a></li><li><a name="Logging_Additional_Information"> <tt>key</tt> must be a valid XML attribute name, and cannot conflict with the ones already used by Google Test (<tt>name</tt>, <tt>status</tt>,     <tt>time</tt>, and <tt>classname</tt>). </a></li></ul><p><a name="Logging_Additional_Information"><i>Availability</i>: Linux, Windows, Mac. </a></p><h1><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">Sharing Resources Between Tests in the Same Test Case</a></h1><p><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">Google
Test creates a new test fixture object for each test in order to make
tests independent and easier to debug. However, sometimes tests use
resources that are expensive to set up, making the one-copy-per-test
model prohibitively expensive. </a></p><p><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">If
the tests don't change the resource, there's no harm in them sharing a
single resource copy. So, in addition to per-test set-up/tear-down,
Google Test also supports per-test-case set-up/tear-down. To use it: </a></p><ol><li><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">In your test fixture class (say <tt>FooTest</tt> ), define as <tt>static</tt> some member variables to hold the shared resources. </a></li><li><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">In the same test fixture class, define a <tt>static void SetUpTestCase()</tt> function (remember not to spell it as <strong><tt>SetupTestCase</tt></strong> with a small <tt>u</tt>!) to set up the shared resources and a <tt>static void TearDownTestCase()</tt> function to tear them down. </a></li></ol><p><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">That's it! Google Test automatically calls <tt>SetUpTestCase()</tt> before running the <i>first test</i> in the <tt>FooTest</tt> test case (i.e. before creating the first <tt>FooTest</tt> object), and calls <tt>TearDownTestCase()</tt> after running the <i>last test</i> in it (i.e. after deleting the last <tt>FooTest</tt> object). In between, the tests can use the shared resources. </a></p><p><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">Remember
that the test order is undefined, so your code can't depend on a test
preceding or following another. Also, the tests must either not modify
the state of any shared resource, or, if they do modify the state, they
must restore the state to its original value before passing control to
the next test. </a></p><p><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case">Here's an example of per-test-case set-up and tear-down: </a></p><pre class="prettyprint"><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case"><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Test</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp;</span><span class="kwd">protected</span><span class="pun">:</span><span class="pln"><br>&nbsp; </span><span class="com">// Per-test-case set-up.</span><span class="pln"><br>&nbsp; </span><span class="com">// Called before the first test in this test case.</span><span class="pln"><br>&nbsp; </span><span class="com">// Can be omitted if not needed.</span><span class="pln"><br>&nbsp; </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">SetUpTestCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; shared_resource_ </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="pun">...;</span><span class="pln"><br>&nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; </span><span class="com">// Per-test-case tear-down.</span><span class="pln"><br>&nbsp; </span><span class="com">// Called after the last test in this test case.</span><span class="pln"><br>&nbsp; </span><span class="com">// Can be omitted if not needed.</span><span class="pln"><br>&nbsp; </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">TearDownTestCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">delete</span><span class="pln"> shared_resource_</span><span class="pun">;</span><span class="pln"><br>&nbsp; &nbsp; shared_resource_ </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; </span><span class="com">// You can define per-test set-up and tear-down logic as usual.</span><span class="pln"><br>&nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">SetUp</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br>&nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">TearDown</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; </span><span class="com">// Some expensive resource shared by all tests.</span><span class="pln"><br>&nbsp; </span><span class="kwd">static</span><span class="pln"> T</span><span class="pun">*</span><span class="pln"> shared_resource_</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">};</span><span class="pln"><br><br>T</span><span class="pun">*</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pun">::</span><span class="pln">shared_resource_ </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span><span class="pln"><br><br>TEST_F</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Test1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"> you can refer to shared_resource here </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br>TEST_F</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Test2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"> you can refer to shared_resource here </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Sharing_Resources_Between_Tests_in_the_Same_Test_Case"><i>Availability:</i> Linux, Windows, Mac. </a></p><h1><a name="Global_Set-Up_and_Tear-Down">Global Set-Up and Tear-Down</a></h1><p><a name="Global_Set-Up_and_Tear-Down">Just
as you can do set-up and tear-down at the test level and the test case
level, you can also do it at the test program level. Here's how. </a></p><p><a name="Global_Set-Up_and_Tear-Down">First, you subclass the <tt>::testing::Environment</tt> class to define a test environment, which knows how to set-up and tear-down: </a></p><pre class="prettyprint"><a name="Global_Set-Up_and_Tear-Down"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Environment</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp;</span><span class="kwd">public</span><span class="pun">:</span><span class="pln"><br>&nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="pun">~</span><span class="typ">Environment</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"><br>&nbsp; </span><span class="com">// Override this to define how to set up the environment.</span><span class="pln"><br>&nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">SetUp</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"><br>&nbsp; </span><span class="com">// Override this to define how to tear down the environment.</span><span class="pln"><br>&nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">TearDown</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"><br></span><span class="pun">};</span></a></pre><p><a name="Global_Set-Up_and_Tear-Down">Then, you register an instance of your environment class with Google Test by calling the <tt>::testing::AddGlobalTestEnvironment()</tt> function: </a></p><pre class="prettyprint"><a name="Global_Set-Up_and_Tear-Down"><span class="typ">Environment</span><span class="pun">*</span><span class="pln"> </span><span class="typ">AddGlobalTestEnvironment</span><span class="pun">(</span><span class="typ">Environment</span><span class="pun">*</span><span class="pln"> env</span><span class="pun">);</span></a></pre><p><a name="Global_Set-Up_and_Tear-Down">Now, when <tt>RUN_ALL_TESTS()</tt> is called, it first calls the <tt>SetUp()</tt> method of the environment object, then runs the tests if there was no fatal failures, and finally calls <tt>TearDown()</tt> of the environment object. </a></p><p><a name="Global_Set-Up_and_Tear-Down">It's OK to register multiple environment objects. In this case, their <tt>SetUp()</tt> will be called in the order they are registered, and their <tt>TearDown()</tt> will be called in the reverse order. </a></p><p><a name="Global_Set-Up_and_Tear-Down">Note that Google Test takes ownership of the registered environment objects. Therefore <strong>do not delete them</strong> by yourself. </a></p><p><a name="Global_Set-Up_and_Tear-Down">You should call <tt>AddGlobalTestEnvironment()</tt> before <tt>RUN_ALL_TESTS()</tt> is called, probably in <tt>main()</tt>. If you use <tt>gtest_main</tt>, you need to      call this before <tt>main()</tt> starts for it to take effect. One way to do this is to define a global variable like this: </a></p><pre class="prettyprint"><a name="Global_Set-Up_and_Tear-Down"><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Environment</span><span class="pun">*</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> foo_env </span><span class="pun">=</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">AddGlobalTestEnvironment</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FooEnvironment</span><span class="pun">);</span></a></pre><p><a name="Global_Set-Up_and_Tear-Down">However, we strongly recommend you to write your own <tt>main()</tt> and call <tt>AddGlobalTestEnvironment()</tt>
there, as relying on initialization of global variables makes the code
harder to read and may cause problems when you register multiple
environments from different translation units and the environments have
dependencies among them (remember that the compiler doesn't guarantee
the order in which global variables from different translation units
are initialized). </a></p><p><a name="Global_Set-Up_and_Tear-Down"><i>Availability:</i> Linux, Windows, Mac. </a></p><h1><a name="Value_Parameterized_Tests">Value Parameterized Tests</a></h1><p><a name="Value_Parameterized_Tests"><i>Value-parameterized tests</i> allow you to test your code with different parameters without writing multiple copies of the same test.  </a></p><p><a name="Value_Parameterized_Tests">Suppose
you write a test for your code and then realize that your code is
affected by a presence of a Boolean command line flag. </a></p><pre class="prettyprint"><a name="Value_Parameterized_Tests"><span class="pln">TEST</span><span class="pun">(</span><span class="typ">MyCodeTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TestFoo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// A code to test foo().</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Value_Parameterized_Tests">Usually
people factor their test code into a function with a Boolean parameter
in such situations. The function sets the flag, then executes the
testing code. </a></p><pre class="prettyprint"><a name="Value_Parameterized_Tests"><span class="kwd">void</span><span class="pln"> </span><span class="typ">TestFooHelper</span><span class="pun">(</span><span class="kwd">bool</span><span class="pln"> flag_value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; flag </span><span class="pun">=</span><span class="pln"> flag_value</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="com">// A code to test foo().</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br>TEST</span><span class="pun">(</span><span class="typ">MyCodeTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TestFooo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="typ">TestFooHelper</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="typ">TestFooHelper</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Value_Parameterized_Tests">But
this setup has serious drawbacks. First, when a test assertion fails in
your tests, it becomes unclear what value of the parameter caused it to
fail. You can stream a clarifying message into your <tt>EXPECT</tt>/<tt>ASSERT</tt>
statements, but it you'll have to do it with all of them. Second, you
have to add one such helper function per test. What if you have ten
tests? Twenty? A hundred? </a></p><p><a name="Value_Parameterized_Tests">Value-parameterized
tests will let you write your test only once and then easily
instantiate and run it with an arbitrary number of parameter values. </a></p><p><a name="Value_Parameterized_Tests">Here are some other situations when value-parameterized tests come handy: </a></p><ul><li><a name="Value_Parameterized_Tests">You wan to test different implementations of an OO interface. </a></li><li><a name="Value_Parameterized_Tests">You
want to test your code over various inputs (a.k.a. data-driven
testing). This feature is easy to abuse, so please exercise your good
sense when doing it! </a></li></ul><h2><a name="How_to_Write_Value-Parameterized_Tests">How to Write Value-Parameterized Tests</a></h2><p><a name="How_to_Write_Value-Parameterized_Tests">To write value-parameterized tests, first you should define a fixture class. It must be derived from <tt>::testing::TestWithParam&lt;T&gt;</tt>, where <tt>T</tt> is the type of your parameter values. <tt>TestWithParam&lt;T&gt;</tt> is itself derived from <tt>::testing::Test</tt>. <tt>T</tt> can be any copyable type. If it's a raw pointer, you are responsible for managing the lifespan of the pointed values. </a></p><pre class="prettyprint"><a name="How_to_Write_Value-Parameterized_Tests"><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">TestWithParam</span><span class="pun">&lt;</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">*&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// You can implement all the usual fixture class members here.</span><span class="pln"><br>&nbsp; </span><span class="com">// To access the test parameter, call GetParam() from class</span><span class="pln"><br>&nbsp; </span><span class="com">// TestWithParam&lt;T&gt;.</span><span class="pln"><br></span><span class="pun">};</span></a></pre><p><a name="How_to_Write_Value-Parameterized_Tests">Then, use the <tt>TEST_P</tt> macro to define as many test patterns using this fixture as you want.  The <tt>_P</tt> suffix is for "parameterized" or "pattern", whichever you prefer to think. </a></p><pre class="prettyprint"><a name="How_to_Write_Value-Parameterized_Tests"><span class="pln">TEST_P</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DoesBlah</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// Inside a test, access the test parameter with the GetParam() method</span><span class="pln"><br>&nbsp; </span><span class="com">// of the TestWithParam&lt;T&gt; class:</span><span class="pln"><br>&nbsp; EXPECT_TRUE</span><span class="pun">(</span><span class="pln">foo</span><span class="pun">.</span><span class="typ">Blah</span><span class="pun">(</span><span class="typ">GetParam</span><span class="pun">()));</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br>TEST_P</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HasBlahBlah</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="How_to_Write_Value-Parameterized_Tests">Finally, you can use <tt>INSTANTIATE_TEST_CASE_P</tt>
to instantiate the test case with any set of parameters you want.
Google Test defines a number of functions for generating test
parameters. They return what we call (surprise!) <i>parameter generators</i>. Here is a summary of them, which are all in the <tt>testing</tt> namespace: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>Range(begin, end[, step])</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Yields values <tt>{begin, begin+step, begin+step+step, ...}</tt>. The values do not include <tt>end</tt>. <tt>step</tt> defaults to 1. </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>Values(v1, v2, ..., vN)</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Yields values <tt>{v1, v2, ..., vN}</tt>. </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>ValuesIn(container)</tt> and <tt>ValuesIn(begin, end)</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Yields values from a C-style array, an STL-style container, or an iterator range <tt>[begin, end)</tt>. </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>Bool()</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Yields sequence <tt>{false, true}</tt>. </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>Combine(g1, g2, ..., gN)</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Yields all combinations (the Cartesian product for the math savvy) of the values generated by the <tt>N</tt> generators. This is only available if your system provides the <tt>&lt;tr1/tuple&gt;</tt> header. If you are sure your system does, and Google Test disagrees, you can override it by defining <tt>GTEST_HAS_TR1_TUPLE=1</tt>. See comments in <a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/internal/gtest-port.h" rel="nofollow">include/gtest/internal/gtest-port.h</a> for more information. </td></tr> </tbody></table><p><a name="How_to_Write_Value-Parameterized_Tests">For more details, see the comments at the definitions of these functions in the </a><a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest-param-test.h" rel="nofollow">source code</a>. </p><p>The following statement will instantiate tests from the <tt>FooTest</tt> test case each with parameter values <tt>"meeny"</tt>, <tt>"miny"</tt>, and <tt>"moe"</tt>. </p><pre class="prettyprint"><span class="pln">INSTANTIATE_TEST_CASE_P</span><span class="pun">(</span><span class="typ">InstantiationName</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Values</span><span class="pun">(</span><span class="str">"meeny"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"miny"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"moe"</span><span class="pun">));</span></pre><p>To distinguish different instances of the pattern (yes, you can instantiate it more than once), the first argument to <tt>INSTANTIATE_TEST_CASE_P</tt>
is a prefix that will be added to the actual test case name. Remember
to pick unique prefixes for different instantiations. The tests from
the instantiation above will have these names: </p><ul><li><tt>InstantiationName/FooTest.DoesBlah/0</tt> for <tt>"meeny"</tt> </li><li><tt>InstantiationName/FooTest.DoesBlah/1</tt> for <tt>"miny"</tt> </li><li><tt>InstantiationName/FooTest.DoesBlah/2</tt> for <tt>"moe"</tt> </li><li><tt>InstantiationName/FooTest.HasBlahBlah/0</tt> for <tt>"meeny"</tt> </li><li><tt>InstantiationName/FooTest.HasBlahBlah/1</tt> for <tt>"miny"</tt> </li><li><tt>InstantiationName/FooTest.HasBlahBlah/2</tt> for <tt>"moe"</tt> </li></ul><p>You can use these names in <a href="#Running_a_Subset_of_the_Tests">--gtest_filter</a>. </p><p>This statement will instantiate all tests from <tt>FooTest</tt> again, each with parameter values <tt>"cat"</tt> and <tt>"dog"</tt>: </p><pre class="prettyprint"><span class="kwd">const</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">*</span><span class="pln"> pets</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="str">"cat"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"dog"</span><span class="pun">};</span><span class="pln"><br>INSTANTIATE_TEST_CASE_P</span><span class="pun">(</span><span class="typ">AnotherInstantiationName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">ValuesIn</span><span class="pun">(</span><span class="pln">pets</span><span class="pun">));</span></pre><p>The tests from the instantiation above will have these names: </p><ul><li><tt>AnotherInstantiationName/FooTest.DoesBlah/0</tt> for <tt>"cat"</tt> </li><li><tt>AnotherInstantiationName/FooTest.DoesBlah/1</tt> for <tt>"dog"</tt> </li><li><tt>AnotherInstantiationName/FooTest.HasBlahBlah/0</tt> for <tt>"cat"</tt> </li><li><tt>AnotherInstantiationName/FooTest.HasBlahBlah/1</tt> for <tt>"dog"</tt> </li></ul><p>Please note that <tt>INSTANTIATE_TEST_CASE_P</tt> will instantiate <i>all</i> tests in the given test case, whether their definitions come before or <i>after</i> the <tt>INSTANTIATE_TEST_CASE_P</tt> statement. </p><p>You can see <a href="http://code.google.com/p/googletest/source/browse/trunk/samples/sample7_unittest.cc" rel="nofollow">these</a> <a href="http://code.google.com/p/googletest/source/browse/trunk/samples/sample8_unittest.cc" rel="nofollow">files</a> for more examples. </p><p><i>Availability</i>: Linux, Windows (requires MSVC 8.0 or above), Mac; since version 1.2.0. </p><h2><a name="Creating_Value-Parameterized_Abstract_Tests">Creating Value-Parameterized Abstract Tests</a></h2><p><a name="Creating_Value-Parameterized_Abstract_Tests">In the above, we define and instantiate <tt>FooTest</tt>
in the same source file. Sometimes you may want to define
value-parameterized tests in a library and let other people instantiate
them later. This pattern is known as <i>abstract tests</i>. As an
example of its application, when you are designing an interface you can
write a standard suite of abstract tests (perhaps using a factory
function as the test parameter) that all implementations of the
interface are expected to pass. When someone implements the interface,
he can instantiate your suite to get all the interface-conformance
tests for free. </a></p><p><a name="Creating_Value-Parameterized_Abstract_Tests">To define abstract tests, you should organize your code like this: </a></p><ol><li><a name="Creating_Value-Parameterized_Abstract_Tests">Put the definition of the parameterized test fixture class (e.g. <tt>FooTest</tt>) in a header file, say <tt>foo_param_test.h</tt>. Think of this as <i>declaring</i> your abstract tests. </a></li><li><a name="Creating_Value-Parameterized_Abstract_Tests">Put the <tt>TEST_P</tt> definitions in <tt>foo_param_test.cc</tt>, which includes <tt>foo_param_test.h</tt>. Think of this as <i>implementing</i> your abstract tests. </a></li></ol><p><a name="Creating_Value-Parameterized_Abstract_Tests">Once they are defined, you can instantiate them by including <tt>foo_param_test.h</tt>, invoking <tt>INSTANTIATE_TEST_CASE_P()</tt>, and linking with <tt>foo_param_test.cc</tt>. You can instantiate the same abstract test case multiple times, possibly in different source files. </a></p><h1><a name="Typed_Tests">Typed Tests</a></h1><p><a name="Typed_Tests">Suppose
you have multiple implementations of the same interface and want to
make sure that all of them satisfy some common requirements. Or, you
may have defined several types that are supposed to conform to the same
"concept" and you want to verify it. In both cases, you want the same
test logic repeated for different types. </a></p><p><a name="Typed_Tests">While you can write one <tt>TEST</tt> or <tt>TEST_F</tt> for each type you want to test (and you may even factor the test logic into a function template that you invoke from the <tt>TEST</tt>), it's tedious and doesn't scale: if you want <i>m</i> tests over <i>n</i> types, you'll end up writing <i>m*n</i> <tt>TEST</tt>s. </a></p><p><a name="Typed_Tests"><i>Typed tests</i>
allow you to repeat the same test logic over a list of types. You only
need to write the test logic once, although you must know the type list
when writing typed tests. Here's how you do it: </a></p><p><a name="Typed_Tests">First, define a fixture class template.  It should be parameterized by a type.  Remember to derive it from <tt>::testing::Test</tt>: </a></p><pre class="prettyprint"><a name="Typed_Tests"><span class="kwd">template</span><span class="pln"> </span><span class="pun">&lt;</span><span class="kwd">typename</span><span class="pln"> T</span><span class="pun">&gt;</span><span class="pln"><br></span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Test</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp;</span><span class="kwd">public</span><span class="pun">:</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br>&nbsp; </span><span class="kwd">typedef</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">list</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">List</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="kwd">static</span><span class="pln"> T shared_</span><span class="pun">;</span><span class="pln"><br>&nbsp; T value_</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">};</span></a></pre><p><a name="Typed_Tests">Next, associate a list of types with the test case, which will be repeated for each type in the list: </a></p><pre class="prettyprint"><a name="Typed_Tests"><span class="kwd">typedef</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Types</span><span class="pun">&lt;</span><span class="kwd">char</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">unsigned</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">MyTypes</span><span class="pun">;</span><span class="pln"><br>TYPED_TEST_CASE</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MyTypes</span><span class="pun">);</span></a></pre><p><a name="Typed_Tests">The <tt>typedef</tt> is necessary for the <tt>TYPED_TEST_CASE</tt> macro to parse correctly.  Otherwise the compiler will think that each comma in the type list introduces a new macro argument. </a></p><p><a name="Typed_Tests">Then, use <tt>TYPED_TEST()</tt> instead of <tt>TEST_F()</tt> to define a typed test for this test case.  You can repeat this as many times as you want: </a></p><pre class="prettyprint"><a name="Typed_Tests"><span class="pln">TYPED_TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DoesBlah</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// Inside a test, refer to the special name TypeParam to get the type</span><span class="pln"><br>&nbsp; </span><span class="com">// parameter. &nbsp;Since we are inside a derived class template, C++ requires</span><span class="pln"><br>&nbsp; </span><span class="com">// us to visit the members of FooTest via 'this'.</span><span class="pln"><br>&nbsp; </span><span class="typ">TypeParam</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">-&gt;</span><span class="pln">value_</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; </span><span class="com">// To visit static members of the fixture, add the 'TestFixture::'</span><span class="pln"><br>&nbsp; </span><span class="com">// prefix.</span><span class="pln"><br>&nbsp; n </span><span class="pun">+=</span><span class="pln"> </span><span class="typ">TestFixture</span><span class="pun">::</span><span class="pln">shared_</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; </span><span class="com">// To refer to typedefs in the fixture, add the 'typename TestFixture::'</span><span class="pln"><br>&nbsp; </span><span class="com">// prefix. &nbsp;The 'typename' is required to satisfy the compiler.</span><span class="pln"><br>&nbsp; </span><span class="kwd">typename</span><span class="pln"> </span><span class="typ">TestFixture</span><span class="pun">::</span><span class="typ">List</span><span class="pln"> values</span><span class="pun">;</span><span class="pln"><br>&nbsp; values</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br>TYPED_TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HasPropertyA</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span></a></pre><p><a name="Typed_Tests">You can see <tt>samples/sample6_unittest.cc</tt> for a complete example. </a></p><p><a name="Typed_Tests"><i>Availability:</i> Linux, Windows (requires MSVC 8.0 or above), Mac; since version 1.1.0. </a></p><h1><a name="Type-Parameterized_Tests">Type-Parameterized Tests</a></h1><p><a name="Type-Parameterized_Tests"><i>Type-parameterized tests</i>
are like typed tests, except that they don't require you to know the
list of types ahead of time. Instead, you can define the test logic
first and instantiate it with different type lists later. You can even
instantiate it more than once in the same program. </a></p><p><a name="Type-Parameterized_Tests">If
you are designing an interface or concept, you can define a suite of
type-parameterized tests to verify properties that any valid
implementation of the interface/concept should have. Then, the author
of each implementation can just instantiate the test suite with his
type to verify that it conforms to the requirements, without having to
write similar tests repeatedly. Here's an example: </a></p><p><a name="Type-Parameterized_Tests">First, define a fixture class template, as we did with typed tests: </a></p><pre class="prettyprint"><a name="Type-Parameterized_Tests"><span class="kwd">template</span><span class="pln"> </span><span class="pun">&lt;</span><span class="kwd">typename</span><span class="pln"> T</span><span class="pun">&gt;</span><span class="pln"><br></span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Test</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">};</span></a></pre><p><a name="Type-Parameterized_Tests">Next, declare that you will define a type-parameterized test case: </a></p><pre class="prettyprint"><a name="Type-Parameterized_Tests"><span class="pln">TYPED_TEST_CASE_P</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">);</span></a></pre><p><a name="Type-Parameterized_Tests">The <tt>_P</tt> suffix is for "parameterized" or "pattern", whichever you prefer to think. </a></p><p><a name="Type-Parameterized_Tests">Then, use <tt>TYPED_TEST_P()</tt> to define a type-parameterized test.  You can repeat this as many times as you want: </a></p><pre class="prettyprint"><a name="Type-Parameterized_Tests"><span class="pln">TYPED_TEST_P</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DoesBlah</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// Inside a test, refer to TypeParam to get the type parameter.</span><span class="pln"><br>&nbsp; </span><span class="typ">TypeParam</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br>TYPED_TEST_P</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HasPropertyA</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span></a></pre><p><a name="Type-Parameterized_Tests">Now the tricky part: you need to register all test patterns using the <tt>REGISTER_TYPED_TEST_CASE_P</tt>
macro before you can instantiate them. The first argument of the macro
is the test case name; the rest are the names of the tests in this test
case: </a></p><pre class="prettyprint"><a name="Type-Parameterized_Tests"><span class="pln">REGISTER_TYPED_TEST_CASE_P</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">DoesBlah</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HasPropertyA</span><span class="pun">);</span></a></pre><p><a name="Type-Parameterized_Tests">Finally, you are free to instantiate the pattern with the types you want.  If you put the above code in a header file, you can <tt>#include</tt> it in multiple C++ source files and instantiate it multiple times. </a></p><pre class="prettyprint"><a name="Type-Parameterized_Tests"><span class="kwd">typedef</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Types</span><span class="pun">&lt;</span><span class="kwd">char</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">unsigned</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">MyTypes</span><span class="pun">;</span><span class="pln"><br>INSTANTIATE_TYPED_TEST_CASE_P</span><span class="pun">(</span><span class="typ">My</span><span class="pun">,</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MyTypes</span><span class="pun">);</span></a></pre><p><a name="Type-Parameterized_Tests">To distinguish different instances of the pattern, the first argument to the <tt>INSTANTIATE_TYPED_TEST_CASE_P</tt> macro is a prefix that will be added to the actual test case name.  Remember to pick unique prefixes for different instances. </a></p><p><a name="Type-Parameterized_Tests">In the special case where the type list contains only one type, you can write that type directly without <tt>::testing::Types&lt;...&gt;</tt>, like this: </a></p><pre class="prettyprint"><a name="Type-Parameterized_Tests"><span class="pln">INSTANTIATE_TYPED_TEST_CASE_P</span><span class="pun">(</span><span class="typ">My</span><span class="pun">,</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">);</span></a></pre><p><a name="Type-Parameterized_Tests">You can see <tt>samples/sample6_unittest.cc</tt> for a complete example. </a></p><p><a name="Type-Parameterized_Tests"><i>Availability:</i> Linux, Windows (requires MSVC 8.0 or above), Mac; since version 1.1.0. </a></p><h1><a name="Testing_Private_Code">Testing Private Code</a></h1><p><a name="Testing_Private_Code">If
you change your software's internal implementation, your tests should
not break as long as the change is not observable by users. Therefore,
per the <i>black-box testing principle</i>, most of the time you should test your code through its public interfaces. </a></p><p><a name="Testing_Private_Code">If
you still find yourself needing to test internal implementation code,
consider if there's a better design that wouldn't require you to do so.
If you absolutely have to test non-public interface code though, you
can. There are two cases to consider: </a></p><ul><li><a name="Testing_Private_Code">Static functions (<i>not</i> the same as static member functions!) or unnamed namespaces, and </a></li><li><a name="Testing_Private_Code">Private or protected class members </a></li></ul><h2><a name="Static_Functions">Static Functions</a></h2><p><a name="Static_Functions">Both
static functions and definitions/declarations in an unnamed namespace
are only visible within the same translation unit. To test them, you
can <tt>#include</tt> the entire <tt>.cc</tt> file being tested in your <tt>*_test.cc</tt> file. (#including <tt>.cc</tt> files is not a good way to reuse code - you should not do this in production code!) </a></p><p><a name="Static_Functions">However, a better approach is to move the private code into the <tt>foo::internal</tt> namespace, where <tt>foo</tt> is the namespace your project normally uses, and put the private declarations in a <tt>*-internal.h</tt> file. Your production <tt>.cc</tt>
files and your tests are allowed to include this internal header, but
your clients are not. This way, you can fully test your internal
implementation without leaking it to your clients. </a></p><h2><a name="Private_Class_Members">Private Class Members</a></h2><p><a name="Private_Class_Members">Private
class members are only accessible from within the class or by friends.
To access a class' private members, you can declare your test fixture
as a friend to the class and define accessors in your fixture. Tests
using the fixture can then access the private members of your
production class via the accessors in the fixture. Note that even
though your fixture is a friend to your production class, your tests
are not automatically friends to it, as they are technically defined in
sub-classes of the fixture. </a></p><p><a name="Private_Class_Members">Another way to test private members is to refactor them into an implementation class, which is then declared in a <tt>*-internal.h</tt>
file. Your clients aren't allowed to include this header but your tests
can. Such is called the Pimpl (Private Implementation) idiom. </a></p><p><a name="Private_Class_Members">Or, you can declare an individual test as a friend of your class by adding this line in the class body: </a></p><pre class="prettyprint"><a name="Private_Class_Members"><span class="pln">FRIEND_TEST</span><span class="pun">(</span><span class="typ">TestCaseName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TestName</span><span class="pun">);</span></a></pre><p><a name="Private_Class_Members">For example, </a></p><pre class="prettyprint"><a name="Private_Class_Members"><span class="com">// foo.h</span><span class="pln"><br></span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;gtest/gtest_prod.h&gt;</span><span class="pln"><br><br></span><span class="com">// Defines FRIEND_TEST.</span><span class="pln"><br></span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br>&nbsp;</span><span class="kwd">private</span><span class="pun">:</span><span class="pln"><br>&nbsp; FRIEND_TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">BarReturnsZeroOnNull</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">*</span><span class="pln"> x</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">};</span><span class="pln"><br><br></span><span class="com">// foo_test.cc</span><span class="pln"><br></span><span class="pun">...</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">BarReturnsZeroOnNull</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="typ">Foo</span><span class="pln"> foo</span><span class="pun">;</span><span class="pln"><br>&nbsp; EXPECT_EQ</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> foo</span><span class="pun">.</span><span class="typ">Bar</span><span class="pun">(</span><span class="pln">NULL</span><span class="pun">));</span><span class="pln"><br>&nbsp; </span><span class="com">// Uses Foo's private member Bar().</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Private_Class_Members">Pay
special attention when your class is defined in a namespace, as you
should define your test fixtures and tests in the same namespace if you
want them to be friends of your class. For example, if the code to be
tested looks like: </a></p><pre class="prettyprint"><a name="Private_Class_Members"><span class="kwd">namespace</span><span class="pln"> my_namespace </span><span class="pun">{</span><span class="pln"><br><br></span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">friend</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pun">;</span><span class="pln"><br>&nbsp; FRIEND_TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">);</span><span class="pln"><br>&nbsp; FRIEND_TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Baz</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br>&nbsp; definition of the </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">};</span><span class="pln"><br><br></span><span class="pun">}</span><span class="pln"> &nbsp;</span><span class="com">// namespace my_namespace</span></a></pre><p><a name="Private_Class_Members">Your test code should be something like: </a></p><pre class="prettyprint"><a name="Private_Class_Members"><span class="kwd">namespace</span><span class="pln"> my_namespace </span><span class="pun">{</span><span class="pln"><br></span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooTest</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Test</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp;</span><span class="kwd">protected</span><span class="pun">:</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">};</span><span class="pln"><br><br>TEST_F</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br>TEST_F</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Baz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br><br></span><span class="pun">}</span><span class="pln"> &nbsp;</span><span class="com">// namespace my_namespace</span></a></pre><h1><a name="Catching_Failures">Catching Failures</a></h1><p><a name="Catching_Failures">If
you are building a testing utility on top of Google Test, you'll want
to test your utility. What framework would you use to test it? Google
Test, of course. </a></p><p><a name="Catching_Failures">The challenge
is to verify that your testing utility reports failures correctly. In
frameworks that report a failure by throwing an exception, you could
catch the exception and assert on it. But Google Test doesn't use
exceptions, so how do we test that a piece of code generates an
expected failure? </a></p><p><a name="Catching_Failures"><tt>&lt;gtest/gtest-spi.h&gt;</tt> contains some constructs to do this.  After #including this header, you can use </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_FATAL_FAILURE(</tt><i>statement, substring</i><tt>);</tt> </td></tr> </tbody></table><p><a name="Catching_Failures">to assert that <i>statement</i> generates a fatal (e.g. <tt>ASSERT_*</tt>) failure whose message contains the given <i>substring</i>, or use </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_NONFATAL_FAILURE(</tt><i>statement, substring</i><tt>);</tt> </td></tr> </tbody></table><p><a name="Catching_Failures">if you are expecting a non-fatal (e.g. <tt>EXPECT_*</tt>) failure. </a></p><p><a name="Catching_Failures">For technical reasons, there are some caveats: </a></p><ol><li><a name="Catching_Failures">You cannot stream a failure message to either macro. </a></li><li><a name="Catching_Failures"><i>statement</i> in <tt>EXPECT_FATAL_FAILURE()</tt> cannot reference local non-static variables or non-static members of <tt>this</tt> object. </a></li><li><a name="Catching_Failures"><i>statement</i> in <tt>EXPECT_FATAL_FAILURE()</tt> cannot return a value. </a></li></ol><p><a name="Catching_Failures"><i>Note:</i> Google Test is designed with threads in mind.  Once the synchronization primitives in <tt>&lt;gtest/internal/gtest-port.h&gt;</tt>
have been implemented, Google Test will become thread-safe, meaning
that you can then use assertions in multiple threads concurrently.
Before </a></p><p><a name="Catching_Failures">that, however, Google Test only supports single-threaded usage.  Once thread-safe, <tt>EXPECT_FATAL_FAILURE()</tt> and <tt>EXPECT_NONFATAL_FAILURE()</tt> will capture failures in the current thread only. If <i>statement</i>
creates new threads, failures in these threads will be ignored. If you
want to capture failures from all threads instead, you should use the
following macros: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_FATAL_FAILURE_ON_ALL_THREADS(</tt><i>statement, substring</i><tt>);</tt> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>EXPECT_NONFATAL_FAILURE_ON_ALL_THREADS(</tt><i>statement, substring</i><tt>);</tt> </td></tr> </tbody></table><h1><a name="Getting_the_Current_Test's_Name">Getting the Current Test's Name</a></h1><p><a name="Getting_the_Current_Test's_Name">Sometimes a function may need to know the name of the currently running test. For example, you may be using the <tt>SetUp()</tt> method of your test fixture to set the golden file name based on which test is running. The <tt>::testing::TestInfo</tt> class has this information: </a></p><pre class="prettyprint"><a name="Getting_the_Current_Test's_Name"><span class="kwd">namespace</span><span class="pln"> testing </span><span class="pun">{</span><span class="pln"><br><br></span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TestInfo</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp;</span><span class="kwd">public</span><span class="pun">:</span><span class="pln"><br>&nbsp; </span><span class="com">// Returns the test case name and the test name, respectively.</span><span class="pln"><br>&nbsp; </span><span class="com">//</span><span class="pln"><br>&nbsp; </span><span class="com">// Do NOT delete or free the return value - it's managed by the</span><span class="pln"><br>&nbsp; </span><span class="com">// TestInfo class.</span><span class="pln"><br>&nbsp; </span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">*</span><span class="pln"> test_case_name</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">const</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">*</span><span class="pln"> name</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">const</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">};</span><span class="pln"><br><br></span><span class="pun">}</span><span class="pln"> &nbsp;</span><span class="com">// namespace testing</span></a></pre><blockquote><a name="Getting_the_Current_Test's_Name">To obtain a <tt>TestInfo</tt> object for the currently running test, call 
</a></blockquote><p><a name="Getting_the_Current_Test's_Name"><tt>current_test_info()</tt> on the <tt>UnitTest</tt> singleton object: </a></p><pre class="prettyprint"><a name="Getting_the_Current_Test's_Name"><span class="com">// Gets information about the currently running test.</span><span class="pln"><br></span><span class="com">// Do NOT delete the returned object - it's managed by the UnitTest class.</span><span class="pln"><br></span><span class="kwd">const</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">TestInfo</span><span class="pun">*</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> test_info </span><span class="pun">=</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">UnitTest</span><span class="pun">::</span><span class="typ">GetInstance</span><span class="pun">()-&gt;</span><span class="pln">current_test_info</span><span class="pun">();</span><span class="pln"><br>printf</span><span class="pun">(</span><span class="str">"We are in test %s of test case %s.\n"</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;test_info</span><span class="pun">-&gt;</span><span class="pln">name</span><span class="pun">(),</span><span class="pln"> test_info</span><span class="pun">-&gt;</span><span class="pln">test_case_name</span><span class="pun">());</span></a></pre><p><a name="Getting_the_Current_Test's_Name"><tt>current_test_info()</tt> returns a null pointer if no test is running. In particular, you cannot find the test case name in <tt>TestCaseSetUp()</tt>, <tt>TestCaseTearDown()</tt> (where you know the test case name implicitly), or functions called from them. </a></p><p><a name="Getting_the_Current_Test's_Name"><i>Availability:</i> Linux, Windows, Mac. </a></p><h1><a name="Extending_Google_Test_by_Handling_Test_Events">Extending Google Test by Handling Test Events</a></h1><p><a name="Extending_Google_Test_by_Handling_Test_Events">Google Test provides an <b>event listener API</b>
to let you receive notifications about the progress of a test program
and test failures. The events you can listen to include the start and
end of the test program, a test case, or a test method, among others.
You may use this API to augment or replace the standard console output,
replace the XML output, or provide a completely different form of
output, such as a GUI or a database. You can also use test events as
checkpoints to implement a resource leak checker, for example. </a></p><p><a name="Extending_Google_Test_by_Handling_Test_Events"><i>Availability:</i> Linux, Windows, Mac; since v1.4.0. </a></p><h2><a name="Defining_Event_Listeners">Defining Event Listeners</a></h2><p><a name="Defining_Event_Listeners">To define a event listener, you subclass either </a><a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest.h#855" rel="nofollow">testing::TestEventListener</a> or <a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest.h#905" rel="nofollow">testing::EmptyTestEventListener</a>. The former is an (abstract) interface, where <i>each pure virtual method can be overridden to handle a test event</i> (For example, when a test starts, the <tt>OnTestStart()</tt>
method will be called.). The latter provides an empty implementation of
all methods in the interface, such that a subclass only needs to
override the methods it cares about. </p><p>When an event is fired, its context is passed to the handler function as an argument. The following argument types are used: </p><ul><li><a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest.h#1007" rel="nofollow">UnitTest</a> reflects the state of the entire test program, </li><li><a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest.h#689" rel="nofollow">TestCase</a> has information about a test case, which can contain one or more tests, </li><li><a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest.h#599" rel="nofollow">TestInfo</a> contains the state of a test, and </li><li><a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest-test-part.h#42" rel="nofollow">TestPartResult</a> represents the result of a test assertion. </li></ul><p>An
event handler function can examine the argument it receives to find out
interesting information about the event and the test program's state.
Here's an example: </p><pre class="prettyprint"><span class="pln">&nbsp; </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MinimalistPrinter</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">EmptyTestEventListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com">// Called before a test starts.</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">OnTestStart</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">TestInfo</span><span class="pun">&amp;</span><span class="pln"> test_info</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; printf</span><span class="pun">(</span><span class="str">"*** Test %s.%s starting.\n"</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;test_info</span><span class="pun">.</span><span class="pln">test_case_name</span><span class="pun">(),</span><span class="pln"> test_info</span><span class="pun">.</span><span class="pln">name</span><span class="pun">());</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">// Called after a failed assertion or a SUCCESS().</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">OnTestPartResult</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">TestPartResult</span><span class="pun">&amp;</span><span class="pln"> test_part_result</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; printf</span><span class="pun">(</span><span class="str">"%s in %s:%d\n%s\n"</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;test_part_result</span><span class="pun">.</span><span class="pln">failed</span><span class="pun">()</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">"*** Failure"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Success"</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;test_part_result</span><span class="pun">.</span><span class="pln">file_name</span><span class="pun">(),</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;test_part_result</span><span class="pun">.</span><span class="pln">line_number</span><span class="pun">(),</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;test_part_result</span><span class="pun">.</span><span class="pln">summary</span><span class="pun">());</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">// Called after a test ends.</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">virtual</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">OnTestEnd</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">TestInfo</span><span class="pun">&amp;</span><span class="pln"> test_info</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; printf</span><span class="pun">(</span><span class="str">"*** Test %s.%s ending.\n"</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;test_info</span><span class="pun">.</span><span class="pln">test_case_name</span><span class="pun">(),</span><span class="pln"> test_info</span><span class="pun">.</span><span class="pln">name</span><span class="pun">());</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; </span><span class="pun">};</span></pre><h2><a name="Using_Event_Listeners">Using Event Listeners</a></h2><p><a name="Using_Event_Listeners">To use the event listener you have defined, add an instance of it to the Google Test event listener list (represented by class </a><a href="http://code.google.com/p/googletest/source/browse/trunk/include/gtest/gtest.h#929" rel="nofollow">TestEventListeners</a> - note the "s" at the end of the name) in your <tt>main()</tt> function, before calling <tt>RUN_ALL_TESTS()</tt>: </p><pre class="prettyprint"><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">**</span><span class="pln"> argv</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">InitGoogleTest</span><span class="pun">(&amp;</span><span class="pln">argc</span><span class="pun">,</span><span class="pln"> argv</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="com">// Gets hold of the event listener list.</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">TestEventListeners</span><span class="pun">&amp;</span><span class="pln"> listeners </span><span class="pun">=</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">UnitTest</span><span class="pun">::</span><span class="typ">GetInstance</span><span class="pun">()-&gt;</span><span class="pln">listeners</span><span class="pun">();</span><span class="pln"><br>&nbsp; </span><span class="com">// Adds a listener to the end. &nbsp;Google Test takes the ownership.</span><span class="pln"><br>&nbsp; listeners</span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MinimalistPrinter</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> RUN_ALL_TESTS</span><span class="pun">();</span><span class="pln"><br></span><span class="pun">}</span></pre><p>There's
only one problem: the default test result printer is still in effect,
so its output will mingle with the output from your minimalist printer.
To suppress the default printer, just release it from the event
listener list and delete it. You can do so by adding one line: </p><pre class="prettyprint"><span class="pln">&nbsp; </span><span class="pun">...</span><span class="pln"><br>&nbsp; </span><span class="kwd">delete</span><span class="pln"> listeners</span><span class="pun">.</span><span class="typ">Release</span><span class="pun">(</span><span class="pln">listeners</span><span class="pun">.</span><span class="pln">default_result_printer</span><span class="pun">());</span><span class="pln"><br>&nbsp; listeners</span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MinimalistPrinter</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> RUN_ALL_TESTS</span><span class="pun">();</span></pre><p>Now, sit back and enjoy a completely different output from your tests. For more details, you can read this <a href="http://code.google.com/p/googletest/source/browse/trunk/samples/sample9_unittest.cc" rel="nofollow">sample</a>. </p><p>You may append more than one listener to the list. When an <tt>On*Start()</tt> or <tt>OnTestPartResult()</tt>
event is fired, the listeners will receive it in the order they appear
in the list (since new listeners are added to the end of the list, the
default text printer and the default XML generator will receive the
event first). An <tt>On*End()</tt> event will be received by the listeners in the <i>reverse</i> order. This allows output by listeners added later to be framed by output from listeners added earlier. </p><h2><a name="Generating_Failures_in_Listeners">Generating Failures in Listeners</a></h2><p><a name="Generating_Failures_in_Listeners">You may use failure-raising macros (<tt>EXPECT_*()</tt>, <tt>ASSERT_*()</tt>, <tt>FAIL()</tt>, etc) when processing an event. There are some restrictions: </a></p><ol><li><a name="Generating_Failures_in_Listeners">You cannot generate any failure in <tt>OnTestPartResult()</tt> (otherwise it will cause <tt>OnTestPartResult()</tt> to be called recursively). </a></li><li><a name="Generating_Failures_in_Listeners">A listener that handles <tt>OnTestPartResult()</tt> is not allowed to generate any failure. </a></li></ol><p><a name="Generating_Failures_in_Listeners">When you add listeners to the listener list, you should put listeners that handle <tt>OnTestPartResult()</tt> <i>before</i>
listeners that can generate failures. This ensures that failures
generated by the latter are attributed to the right test by the former.
</a></p><p><a name="Generating_Failures_in_Listeners">We have a sample of failure-raising listener </a><a href="http://code.google.com/p/googletest/source/browse/trunk/samples/sample10_unittest.cc" rel="nofollow">here</a>. </p><h1><a name="Running_Test_Programs:_Advanced_Options">Running Test Programs: Advanced Options</a></h1><p><a name="Running_Test_Programs:_Advanced_Options">Google
Test test programs are ordinary executables. Once built, you can run
them directly and affect their behavior via the following environment
variables and/or command line flags. For the flags to work, your
programs must call <tt>::testing::InitGoogleTest()</tt> before calling <tt>RUN_ALL_TESTS()</tt>. </a></p><p><a name="Running_Test_Programs:_Advanced_Options">To see a list of supported flags and their usage, please run your test program with the <tt>--help</tt> flag.  You can also use <tt>-h</tt>, <tt>-?</tt>, or <tt>/?</tt> for short.  This feature is added in version 1.3.0. </a></p><p><a name="Running_Test_Programs:_Advanced_Options">If
an option is specified both by an environment variable and by a flag,
the latter takes precedence. Most of the options can also be set/read
in code: to access the value of command line flag <tt>--gtest_foo</tt>, write <tt>::testing::GTEST_FLAG(foo)</tt>.  A common pattern is to set the value of a flag before calling <tt>::testing::InitGoogleTest()</tt> to change the default value of the flag: </a></p><pre class="prettyprint"><a name="Running_Test_Programs:_Advanced_Options"><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">**</span><span class="pln"> argv</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// Disables elapsed time by default.</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="pln">GTEST_FLAG</span><span class="pun">(</span><span class="pln">print_time</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; </span><span class="com">// This allows the user to override the flag on the command line.</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">InitGoogleTest</span><span class="pun">(&amp;</span><span class="pln">argc</span><span class="pun">,</span><span class="pln"> argv</span><span class="pun">);</span><span class="pln"><br><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> RUN_ALL_TESTS</span><span class="pun">();</span><span class="pln"><br></span><span class="pun">}</span></a></pre><h2><a name="Selecting_Tests">Selecting Tests</a></h2><p><a name="Selecting_Tests">This section shows various options for choosing which tests to run. </a></p><h3><a name="Listing_Test_Names">Listing Test Names</a></h3><p><a name="Listing_Test_Names">Sometimes
it is necessary to list the available tests in a program before running
them so that a filter may be applied if needed. Including the flag <tt>--gtest_list_tests</tt> overrides all other flags and lists tests in the following format: </a></p><pre class="prettyprint"><a name="Listing_Test_Names"><span class="typ">TestCase1</span><span class="pun">.</span><span class="pln"><br>&nbsp; </span><span class="typ">TestName1</span><span class="pln"><br>&nbsp; </span><span class="typ">TestName2</span><span class="pln"><br></span><span class="typ">TestCase2</span><span class="pun">.</span><span class="pln"><br>&nbsp; </span><span class="typ">TestName</span></a></pre><p><a name="Listing_Test_Names">None
of the tests listed are actually run if the flag is provided. There is
no corresponding environment variable for this flag. </a></p><p><a name="Listing_Test_Names"><i>Availability:</i> Linux, Windows, Mac. </a></p><h3><a name="Running_a_Subset_of_the_Tests">Running a Subset of the Tests</a></h3><p><a name="Running_a_Subset_of_the_Tests">By
default, a Google Test program runs all tests the user has defined.
Sometimes, you want to run only a subset of the tests (e.g. for
debugging or quickly verifying a change). If you set the <tt>GTEST_FILTER</tt> environment variable or the <tt>--gtest_filter</tt> flag to a filter string, Google Test will only run the tests whose full names (in the form of <tt>TestCaseName.TestName</tt>) match the filter. </a></p><p><a name="Running_a_Subset_of_the_Tests">The format of a filter is a '<tt>:</tt>'-separated list of wildcard patterns (called the positive patterns) optionally followed by a '<tt>-</tt>' and another '<tt>:</tt>'-separated
pattern list (called the negative patterns). A test matches the filter
if and only if it matches any of the positive patterns but does not
match any of the negative patterns. </a></p><p><a name="Running_a_Subset_of_the_Tests">A pattern may contain <tt>'*'</tt> (matches any string) or <tt>'?'</tt> (matches any single character). For convenience, the filter <tt>'*-NegativePatterns'</tt> can be also written as <tt>'-NegativePatterns'</tt>. </a></p><p><a name="Running_a_Subset_of_the_Tests">For example: </a></p><ul><li><a name="Running_a_Subset_of_the_Tests"> <tt>./foo_test</tt> Has no flag, and thus runs all its tests. </a></li><li><a name="Running_a_Subset_of_the_Tests"> <tt>./foo_test --gtest_filter=*</tt> Also runs everything, due to the single match-everything <tt>*</tt> value. </a></li><li><a name="Running_a_Subset_of_the_Tests"> <tt>./foo_test --gtest_filter=FooTest.*</tt> Runs everything in test case <tt>FooTest</tt>. </a></li><li><a name="Running_a_Subset_of_the_Tests"> <tt>./foo_test --gtest_filter=*Null*:*Constructor*</tt> Runs any test whose full name contains either <tt>"Null"</tt> or <tt>"Constructor"</tt>. </a></li><li><a name="Running_a_Subset_of_the_Tests"> <tt>./foo_test --gtest_filter=-*DeathTest.*</tt> Runs all non-death tests. </a></li><li><a name="Running_a_Subset_of_the_Tests"> <tt>./foo_test --gtest_filter=FooTest.*-FooTest.Bar</tt> Runs everything in test case <tt>FooTest</tt> except <tt>FooTest.Bar</tt>. </a></li></ul><p><a name="Running_a_Subset_of_the_Tests"><i>Availability:</i> Linux, Windows, Mac. </a></p><h3><a name="Temporarily_Disabling_Tests">Temporarily Disabling Tests</a></h3><p><a name="Temporarily_Disabling_Tests">If you have a broken test that you cannot fix right away, you can add the <tt>DISABLED_</tt> prefix to its name. This will exclude it from execution. This is better than commenting out the code or using <tt>#if 0</tt>, as disabled tests are still compiled (and thus won't rot). </a></p><p><a name="Temporarily_Disabling_Tests">If you need to disable all tests in a test case, you can either add <tt>DISABLED_</tt> to the front of the name of each test, or alternatively add it to the front of the test case name. </a></p><p><a name="Temporarily_Disabling_Tests">For example, the following tests won't be run by Google Test, even though they will still be compiled: </a></p><pre class="prettyprint"><a name="Temporarily_Disabling_Tests"><span class="com">// Tests that Foo does Abc.</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="typ">FooTest</span><span class="pun">,</span><span class="pln"> DISABLED_DoesAbc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br><br></span><span class="kwd">class</span><span class="pln"> DISABLED_BarTest </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">Test</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">};</span><span class="pln"><br><br></span><span class="com">// Tests that Bar does Xyz.</span><span class="pln"><br>TEST_F</span><span class="pun">(</span><span class="pln">DISABLED_BarTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DoesXyz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span></a></pre><p><a name="Temporarily_Disabling_Tests"><i>Note:</i>
This feature should only be used for temporary pain-relief. You still
have to fix the disabled tests at a later date. As a reminder, Google
Test will print a banner warning you if a test program contains any
disabled tests. </a></p><p><a name="Temporarily_Disabling_Tests"><i>Tip:</i> You can easily count the number of disabled tests you have using <tt>grep</tt>. This number can be used as a metric for improving your test quality. </a></p><p><a name="Temporarily_Disabling_Tests"><i>Availability:</i> Linux, Windows, Mac. </a></p><h3><a name="Temporarily_Enabling_Disabled_Tests">Temporarily Enabling Disabled Tests</a></h3><p><a name="Temporarily_Enabling_Disabled_Tests">To include </a><a href="#Temporarily_Disabling_Tests">disabled tests</a> in test execution, just invoke the test program with the <tt>--gtest_also_run_disabled_tests</tt> flag or set the <tt>GTEST_ALSO_RUN_DISABLED_TESTS</tt> environment variable to a value other than <tt>0</tt>.  You can combine this with the <a href="#Running_a_Subset_of_the_Tests">--gtest_filter</a> flag to further select which disabled tests to run. </p><p><i>Availability:</i> Linux, Windows, Mac; since version 1.3.0. </p><h2><a name="Repeating_the_Tests">Repeating the Tests</a></h2><p><a name="Repeating_the_Tests">Once
in a while you'll run into a test whose result is hit-or-miss. Perhaps
it will fail only 1% of the time, making it rather hard to reproduce
the bug under a debugger. This can be a major source of frustration. </a></p><p><a name="Repeating_the_Tests">The <tt>--gtest_repeat</tt>
flag allows you to repeat all (or selected) test methods in a program
many times. Hopefully, a flaky test will eventually fail and give you a
chance to debug. Here's how to use it: </a></p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>$ foo_test --gtest_repeat=1000</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Repeat foo_test 1000 times and don't stop at failures. </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>$ foo_test --gtest_repeat=-1</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> A negative count means repeating forever. </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>$ foo_test --gtest_repeat=1000 --gtest_break_on_failure</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">
Repeat foo_test 1000 times, stopping at the first failure. This is
especially useful when running under a debugger: when the testfails, it
will drop into the debugger and you can then inspect variables and
stacks. </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <tt>$ foo_test --gtest_repeat=1000 --gtest_filter=FooBar</tt> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Repeat the tests whose name matches the filter 1000 times. </td></tr> </tbody></table><p><a name="Repeating_the_Tests">If your test program contains global set-up/tear-down code registered using <tt>AddGlobalTestEnvironment()</tt>,
it will be repeated in each iteration as well, as the flakiness may be
in it. You can also specify the repeat count by setting the <tt>GTEST_REPEAT</tt> environment variable. </a></p><p><a name="Repeating_the_Tests"><i>Availability:</i> Linux, Windows, Mac. </a></p><h2><a name="Shuffling_the_Tests">Shuffling the Tests</a></h2><p><a name="Shuffling_the_Tests">You can specify the <tt>--gtest_shuffle</tt> flag (or set the <tt>GTEST_SHUFFLE</tt> environment variable to <tt>1</tt>) to run the tests in a program in a random order. This helps to reveal bad dependencies between tests. </a></p><p><a name="Shuffling_the_Tests">By
default, Google Test uses a random seed calculated from the current
time. Therefore you'll get a different order every time. The console
output includes the random seed value, such that you can reproduce an
order-related test failure later. To specify the random seed
explicitly, use the <tt>--gtest_random_seed=SEED</tt> flag (or set the <tt>GTEST_RANDOM_SEED</tt> environment variable), where <tt>SEED</tt>
is an integer between 0 and 99999. The seed value 0 is special: it
tells Google Test to do the default behavior of calculating the seed
from the current time. </a></p><p><a name="Shuffling_the_Tests">If you combine this with <tt>--gtest_repeat=N</tt>, Google Test will pick a different random seed and re-shuffle the tests in each iteration. </a></p><p><a name="Shuffling_the_Tests"><i>Availability:</i> Linux, Windows, Mac; since v1.4.0. </a></p><h2><a name="Controlling_Test_Output">Controlling Test Output</a></h2><p><a name="Controlling_Test_Output">This section teaches how to tweak the way test results are reported. </a></p><h3><a name="Colored_Terminal_Output">Colored Terminal Output</a></h3><p><a name="Colored_Terminal_Output">Google
Test can use colors in its terminal output to make it easier to spot
the separation between tests, and whether tests passed. </a></p><p><a name="Colored_Terminal_Output">You can set the GTEST_COLOR environment variable or set the <tt>--gtest_color</tt> command line flag to <tt>yes</tt>, <tt>no</tt>, or <tt>auto</tt> (the default) to enable colors, disable colors, or let Google Test decide. When the value is <tt>auto</tt>, Google Test will use colors if and only if the output goes to a terminal and (on non-Windows platforms) the <tt>TERM</tt> environment variable is set to <tt>xterm</tt> or <tt>xterm-color</tt>. </a></p><p><a name="Colored_Terminal_Output"><i>Availability:</i> Linux, Windows, Mac. </a></p><h3><a name="Suppressing_the_Elapsed_Time">Suppressing the Elapsed Time</a></h3><p><a name="Suppressing_the_Elapsed_Time">By default, Google Test prints the time it takes to run each test.  To suppress that, run the test program with the <tt>--gtest_print_time=0</tt> command line flag.  Setting the <tt>GTEST_PRINT_TIME</tt> environment variable to <tt>0</tt> has the same effect. </a></p><p><a name="Suppressing_the_Elapsed_Time"><i>Availability:</i> Linux, Windows, Mac.  (In Google Test 1.3.0 and lower, the default behavior is that the elapsed time is <strong>not</strong> printed.) </a></p><h3><a name="Generating_an_XML_Report">Generating an XML Report</a></h3><p><a name="Generating_an_XML_Report">Google
Test can emit a detailed XML report to a file in addition to its normal
textual output. The report contains the duration of each test, and thus
can help you identify slow tests. </a></p><p><a name="Generating_an_XML_Report">To generate the XML report, set the <tt>GTEST_OUTPUT</tt> environment variable or the <tt>--gtest_output</tt> flag to the string <tt>"xml:_path_to_output_file_"</tt>, which will create the file at the given location. You can also just use the string <tt>"xml"</tt>, in which case the output can be found in the <tt>test_detail.xml</tt> file in the current directory. </a></p><p><a name="Generating_an_XML_Report">If you specify a directory (for example, <tt>"xml:output/directory/"</tt> on Linux or <tt>"xml:output\directory\"</tt> on Windows), Google Test will create the XML file in that directory, named after the test executable (e.g. <tt>foo_test.xml</tt> for test program <tt>foo_test</tt> or <tt>foo_test.exe</tt>). If the file already exists (perhaps left over from a previous run), Google Test will pick a different name (e.g. <tt>foo_test_1.xml</tt>) to avoid overwriting it. </a></p><p><a name="Generating_an_XML_Report">The report uses the format described here.  It is based on the <tt>junitreport</tt> Ant task and can be parsed by popular continuous build systems like </a><a href="https://hudson.dev.java.net/" rel="nofollow">Hudson</a>.
Since that format was originally intended for Java, a little
interpretation is required to make it apply to Google Test tests, as
shown here: </p><pre class="prettyprint"><span class="tag">&lt;testsuites</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"AllTests"</span><span class="pln"> ...</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;testsuite</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"test_case_name"</span><span class="pln"> ...</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;testcase</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"test_name"</span><span class="pln"> ...</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;failure</span><span class="pln"> </span><span class="atn">message</span><span class="pun">=</span><span class="atv">"..."</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;failure</span><span class="pln"> </span><span class="atn">message</span><span class="pun">=</span><span class="atv">"..."</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;failure</span><span class="pln"> </span><span class="atn">message</span><span class="pun">=</span><span class="atv">"..."</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;/testcase&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;/testsuite&gt;</span><span class="pln"><br></span><span class="tag">&lt;/testsuites&gt;</span></pre><ul><li>The root <tt>&lt;testsuites&gt;</tt> element corresponds to the entire test program. </li><li><tt>&lt;testsuite&gt;</tt> elements correspond to Google Test test cases. </li><li><tt>&lt;testcase&gt;</tt> elements correspond to Google Test test functions. </li></ul><p>For instance, the following program </p><pre class="prettyprint"><span class="pln">TEST</span><span class="pun">(</span><span class="typ">MathTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Addition</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="typ">MathTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Subtraction</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="typ">LogicTest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">NonContradiction</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span></pre><p>could generate this report: </p><pre class="prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln"><br></span><span class="tag">&lt;testsuites</span><span class="pln"> </span><span class="atn">tests</span><span class="pun">=</span><span class="atv">"3"</span><span class="pln"> </span><span class="atn">failures</span><span class="pun">=</span><span class="atv">"1"</span><span class="pln"> </span><span class="atn">errors</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">time</span><span class="pun">=</span><span class="atv">"35"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"AllTests"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;testsuite</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"MathTest"</span><span class="pln"> </span><span class="atn">tests</span><span class="pun">=</span><span class="atv">"2"</span><span class="pln"> </span><span class="atn">failures</span><span class="pun">=</span><span class="atv">"1"</span><span class="pln">* </span><span class="atn">errors</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">time</span><span class="pun">=</span><span class="atv">"15"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;testcase</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Addition"</span><span class="pln"> </span><span class="atn">status</span><span class="pun">=</span><span class="atv">"run"</span><span class="pln"> </span><span class="atn">time</span><span class="pun">=</span><span class="atv">"7"</span><span class="pln"> </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;failure</span><span class="pln"> </span><span class="atn">message</span><span class="pun">=</span><span class="atv">"Value of: add(1, 1)&amp;#x0A; Actual: 3&amp;#x0A;Expected: 2"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">""</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;failure</span><span class="pln"> </span><span class="atn">message</span><span class="pun">=</span><span class="atv">"Value of: add(1, -1)&amp;#x0A; Actual: 1&amp;#x0A;Expected: 0"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">""</span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;/testcase&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;testcase</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Subtraction"</span><span class="pln"> </span><span class="atn">status</span><span class="pun">=</span><span class="atv">"run"</span><span class="pln"> </span><span class="atn">time</span><span class="pun">=</span><span class="atv">"5"</span><span class="pln"> </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;/testcase&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;/testsuite&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;testsuite</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"LogicTest"</span><span class="pln"> </span><span class="atn">tests</span><span class="pun">=</span><span class="atv">"1"</span><span class="pln"> </span><span class="atn">failures</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">errors</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">time</span><span class="pun">=</span><span class="atv">"5"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;testcase</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"NonContradiction"</span><span class="pln"> </span><span class="atn">status</span><span class="pun">=</span><span class="atv">"run"</span><span class="pln"> </span><span class="atn">time</span><span class="pun">=</span><span class="atv">"5"</span><span class="pln"> </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="tag">&lt;/testcase&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;/testsuite&gt;</span><span class="pln"><br></span><span class="tag">&lt;/testsuites&gt;</span></pre><p>Things to note: </p><ul><li>The <tt>tests</tt> attribute of a <tt>&lt;testsuites&gt;</tt> or <tt>&lt;testsuite&gt;</tt> element tells how many test functions the Google Test program or test case contains, while the <tt>failures</tt> attribute tells how many of them failed. </li><li>The <tt>time</tt> attribute expresses the duration of the test, test case, or entire test program in milliseconds. </li><li>Each <tt>&lt;failure&gt;</tt> element corresponds to a single failed Google Test assertion. </li><li>Some
JUnit concepts don't apply to Google Test, yet we have to conform to
the DTD. Therefore you'll see some dummy elements and attributes in the
report. You can safely ignore these parts. </li></ul><p><i>Availability:</i> Linux, Windows, Mac. </p><h2><a name="Controlling_How_Failures_Are_Reported">Controlling How Failures Are Reported</a></h2><h3><a name="Turning_Assertion_Failures_into_Break-Points">Turning Assertion Failures into Break-Points</a></h3><p><a name="Turning_Assertion_Failures_into_Break-Points">When
running test programs under a debugger, it's very convenient if the
debugger can catch an assertion failure and automatically drop into
interactive mode. Google Test's <i>break-on-failure</i> mode supports this behavior. </a></p><p><a name="Turning_Assertion_Failures_into_Break-Points">To enable it, set the <tt>GTEST_BREAK_ON_FAILURE</tt> environment variable to a value other than <tt>0</tt> . Alternatively, you can use the <tt>--gtest_break_on_failure</tt> command line flag. </a></p><p><a name="Turning_Assertion_Failures_into_Break-Points"><i>Availability:</i> Linux, Windows, Mac. </a></p><h3><a name="Suppressing_Pop-ups_Caused_by_Exceptions">Suppressing Pop-ups Caused by Exceptions</a></h3><p><a name="Suppressing_Pop-ups_Caused_by_Exceptions">On
Windows, Google Test may be used with exceptions enabled. Even when
exceptions are disabled, an application can still throw structured
exceptions (SEH's). If a test throws an exception, by default Google
Test doesn't try to catch it. Instead, you'll see a pop-up dialog, at
which point you can attach the process to a debugger and easily find
out what went wrong. </a></p><p><a name="Suppressing_Pop-ups_Caused_by_Exceptions">However, if you don't want to see the pop-ups (for example, if you run the tests in a batch job), set the <tt>GTEST_CATCH_EXCEPTIONS</tt> environment variable to a non- <tt>0</tt> value, or use the <tt>--gtest_catch_exceptions</tt> flag. Google Test now catches all test-thrown exceptions and logs them as failures. </a></p><p><a name="Suppressing_Pop-ups_Caused_by_Exceptions"><i>Availability:</i> Windows. <tt>GTEST_CATCH_EXCEPTIONS</tt> and <tt>--gtest_catch_exceptions</tt>
have no effect on Google Test's behavior on Linux or Mac, even if
exceptions are enabled. It is possible to add support for catching
exceptions on these platforms, but it is not implemented yet. </a></p><h3><a name="Letting_Another_Testing_Framework_Drive">Letting Another Testing Framework Drive</a></h3><p><a name="Letting_Another_Testing_Framework_Drive">If
you work on a project that has already been using another testing
framework and is not ready to completely switch to Google Test yet, you
can get much of Google Test's benefit by using its assertions in your
existing tests. Just change your <tt>main()</tt> function to look like: </a></p><pre class="prettyprint"><a name="Letting_Another_Testing_Framework_Drive"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;gtest/gtest.h&gt;</span><span class="pln"><br><br></span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">**</span><span class="pln"> argv</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="pln">GTEST_FLAG</span><span class="pun">(</span><span class="pln">throw_on_failure</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="com">// Important: Google Test must be initialized.</span><span class="pln"><br>&nbsp; </span><span class="pun">::</span><span class="pln">testing</span><span class="pun">::</span><span class="typ">InitGoogleTest</span><span class="pun">(&amp;</span><span class="pln">argc</span><span class="pun">,</span><span class="pln"> argv</span><span class="pun">);</span><span class="pln"><br><br>&nbsp; </span><span class="pun">...</span><span class="pln"> whatever your existing testing framework requires </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Letting_Another_Testing_Framework_Drive">With
that, you can use Google Test assertions in addition to the native
assertions your testing framework provides, for example: </a></p><pre class="prettyprint"><a name="Letting_Another_Testing_Framework_Drive"><span class="kwd">void</span><span class="pln"> </span><span class="typ">TestFooDoesBar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="typ">Foo</span><span class="pln"> foo</span><span class="pun">;</span><span class="pln"><br>&nbsp; EXPECT_LE</span><span class="pun">(</span><span class="pln">foo</span><span class="pun">.</span><span class="typ">Bar</span><span class="pun">(</span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="lit">100</span><span class="pun">);</span><span class="pln"> &nbsp; &nbsp; </span><span class="com">// A Google Test assertion.</span><span class="pln"><br>&nbsp; CPPUNIT_ASSERT</span><span class="pun">(</span><span class="pln">foo</span><span class="pun">.</span><span class="typ">IsEmpty</span><span class="pun">());</span><span class="pln"> &nbsp;</span><span class="com">// A native assertion.</span><span class="pln"><br></span><span class="pun">}</span></a></pre><p><a name="Letting_Another_Testing_Framework_Drive">If
a Google Test assertion fails, it will print an error message and throw
an exception, which will be treated as a failure by your host testing
framework. If you compile your code with exceptions disabled, a failed
Google Test assertion will instead exit your program with a non-zero
code, which will also signal a test failure to your test runner. </a></p><p><a name="Letting_Another_Testing_Framework_Drive">If you don't write <tt>::testing::GTEST_FLAG(throw_on_failure) = true;</tt> in your <tt>main()</tt>, you can alternatively enable this feature by specifying the <tt>--gtest_throw_on_failure</tt> flag on the command-line or setting the <tt>GTEST_THROW_ON_FAILURE</tt> environment variable to a non-zero value. </a></p><p><a name="Letting_Another_Testing_Framework_Drive"><i>Availability:</i> Linux, Windows, Mac; since v1.3.0. </a></p><h2><a name="Distributing_Test_Functions_to_Multiple_Machines">Distributing Test Functions to Multiple Machines</a></h2><p><a name="Distributing_Test_Functions_to_Multiple_Machines">If
you have more than one machine you can use to run a test program, you
might want to run the test functions in parallel and get the result
faster. We call this technique <i>sharding</i>, where each machine is called a <i>shard</i>. </a></p><p><a name="Distributing_Test_Functions_to_Multiple_Machines">Google
Test is compatible with test sharding. To take advantage of this
feature, your test runner (not part of Google Test) needs to do the
following: </a></p><ol><li><a name="Distributing_Test_Functions_to_Multiple_Machines">Allocate a number of machines (shards) to run the tests. </a></li><li><a name="Distributing_Test_Functions_to_Multiple_Machines">On each shard, set the <tt>GTEST_TOTAL_SHARDS</tt> environment variable to the total number of shards.  It must be the same for all shards. </a></li><li><a name="Distributing_Test_Functions_to_Multiple_Machines">On each shard, set the <tt>GTEST_SHARD_INDEX</tt>
environment variable to the index of the shard. Different shards must
be assigned different indices, which must be in the range <tt>[0, GTEST_TOTAL_SHARDS - 1]</tt>. </a></li><li><a name="Distributing_Test_Functions_to_Multiple_Machines">Run
the same test program on all shards. When Google Test sees the above
two environment variables, it will select a subset of the test
functions to run. Across all shards, each test function in the program
will be run exactly once. </a></li><li><a name="Distributing_Test_Functions_to_Multiple_Machines">Wait for all shards to finish, then collect and report the results. </a></li></ol><p><a name="Distributing_Test_Functions_to_Multiple_Machines">Your
project may have tests that were written without Google Test and thus
don't understand this protocol. In order for your test runner to figure
out which test supports sharding, it can set the environment variable <tt>GTEST_SHARD_STATUS_FILE</tt>
to a non-existent file path. If a test program supports sharding, it
will create this file to acknowledge the fact (the actual contents of
the file are not important at this time; although we may stick some
useful information in it in the future.); otherwise it will not create
it. </a></p><p><a name="Distributing_Test_Functions_to_Multiple_Machines">Here's an example to make it clear.  Suppose you have a test program <tt>foo_test</tt> that contains the following 5 test functions: </a></p><pre class="prettyprint"><a name="Distributing_Test_Functions_to_Multiple_Machines"><span class="pln">TEST</span><span class="pun">(</span><span class="pln">A</span><span class="pun">,</span><span class="pln"> V</span><span class="pun">)</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="pln">A</span><span class="pun">,</span><span class="pln"> W</span><span class="pun">)</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="pln">B</span><span class="pun">,</span><span class="pln"> X</span><span class="pun">)</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="pln">B</span><span class="pun">,</span><span class="pln"> Y</span><span class="pun">)</span><span class="pln"><br>TEST</span><span class="pun">(</span><span class="pln">B</span><span class="pun">,</span><span class="pln"> Z</span><span class="pun">)</span></a></pre><p><a name="Distributing_Test_Functions_to_Multiple_Machines">and you have 3 machines at your disposal.  To run the test functions in parallel, you would set <tt>GTEST_TOTAL_SHARDS</tt> to 3 on all machines, and set <tt>GTEST_SHARD_INDEX</tt> to 0, 1, and 2 on the machines respectively. Then you would run the same <tt>foo_test</tt> on each machine. </a></p><p><a name="Distributing_Test_Functions_to_Multiple_Machines">Google Test reserves the right to change how the work is distributed across the shards, but here's one possible scenario: </a></p><ul><li><a name="Distributing_Test_Functions_to_Multiple_Machines">Machine #0 runs <tt>A.V</tt> and <tt>B.X</tt>. </a></li><li><a name="Distributing_Test_Functions_to_Multiple_Machines">Machine #1 runs <tt>A.W</tt> and <tt>B.Y</tt>. </a></li><li><a name="Distributing_Test_Functions_to_Multiple_Machines">Machine #2 runs <tt>B.Z</tt>. </a></li></ul><p><a name="Distributing_Test_Functions_to_Multiple_Machines"><i>Availability:</i> Linux, Windows, Mac; since version 1.3.0. </a></p><h1><a name="Fusing_Google_Test_Source_Files">Fusing Google Test Source Files</a></h1><p><a name="Fusing_Google_Test_Source_Files">Google
Test's implementation consists of ~30 files (excluding its own tests).
Sometimes you may want them to be packaged up in two files (a <tt>.h</tt> and a <tt>.cc</tt>)
instead, such that you can easily copy them to a new machine and start
hacking there. For this we provide an experimental Python script <tt>fuse_gtest_files.py</tt> in the <tt>scripts/</tt>
directory (since release 1.3.0). Assuming you have Python 2.4 or above
installed on your machine, just go to that directory and run </a></p><pre class="prettyprint"><a name="Fusing_Google_Test_Source_Files"><span class="pln">python fuse_gtest_files</span><span class="pun">.</span><span class="pln">py OUTPUT_DIR</span></a></pre><p><a name="Fusing_Google_Test_Source_Files">and you should see an <tt>OUTPUT_DIR</tt> directory being created with files <tt>gtest/gtest.h</tt> and <tt>gtest/gtest-all.cc</tt>
in it. These files contain everything you need to use Google Test. Just
copy them to anywhere you want and you are ready to write tests. You
can use the </a><a href="http://code.google.com/p/googletest/source/browse/trunk/scripts/test/Makefile" rel="nofollow">scrpts/test/Makefile</a> file as an example on how to compile your tests against them. </p><h1><a name="Where_to_Go_from_Here">Where to Go from Here</a></h1><p><a name="Where_to_Go_from_Here">Congratulations!
You've now learned more advanced Google Test tools and are ready to
tackle more complex testing tasks. If you want to dive even deeper, you
can read the </a><a href="http://code.google.com/p/googletest/wiki/GoogleTestFAQ" rel="nofollow">GoogleTestFAQ</a>. </p>
 </td> 
 </tr>
 </tbody></table>
 </div>


 
 <br>
 


 
 
 
 
 
 
 
 
 
 
 

<div class="collapse">


 


<div id="commentlist">

 
 <div class="artifactcomment">
 
 
 
 
 
 
 <span class="author">Comment
 
 by
 
 <a style="white-space: nowrap;" href="http://code.google.com/u/raine.c/">raine.c</a>,
 
 </span>
 <span class="date" title="Thu Jul 17 08:40:01 2008">Jul 17, 2008</span>
 <div>
<div class="commentcontent">
<p>Just a few questions:  </p><p>In the xml-output, in what unit is the elapsed time measured? Is it in milliseconds?  </p><p>If
the running times of each testcase do not sum up to the total running
time of the enclosing testsuite, can the difference be the overhead
induced by Setup() and TearDown<a href="http://code.google.com/p/googletest/w/edit/TearDown">?</a>() methods? </p>
</div>
 
 
 </div>
 </div>
 

 
 <div class="artifactcomment">
 
 
 
 
 
 
 <span class="author">Comment
 
 by
 
 <a style="white-space: nowrap;" href="http://code.google.com/u/caleb.epstein/">caleb.epstein</a>,
 
 </span>
 <span class="date" title="Sun Aug 17 09:33:12 2008">Aug 17, 2008</span>
 <div>
<div class="commentcontent">
<p>GTEST_PRINT_TIME / --gtest_print_time do not seem to be implemented in the 1.0.1 code. </p>
</div>
 
 
 </div>
 </div>
 

 
 <div class="artifactcomment">
 
 
 
 
 
 
 <span class="author">Comment
 
 by
 
 <a style="white-space: nowrap;" href="http://code.google.com/u/ben.mathews01/">ben.mathews01</a>,
 
 </span>
 <span class="date" title="Fri Dec 12 16:04:31 2008">Dec 12, 2008</span>
 <div>
<div class="commentcontent">
<p>How do I control the verbosity of the output?  Most test frameworks only print failures.  I don't want hundreds of OK messages. </p>
</div>
 
 
 </div>
 </div>
 

 
 <div class="artifactcomment">
 
 
 
 
 
 
 <span class="author">Comment
 
 by
 
 <a style="white-space: nowrap;" href="http://code.google.com/u/Goosey/">Goosey</a>,
 
 </span>
 <span class="date" title="Sat Dec 13 13:00:50 2008">Dec 13, 2008</span>
 <div>
<div class="commentcontent">
<p>&gt; How do I control the verbosity of the output? Most test
frameworks only print failures. I don't want hundreds of OK messages. I
second this and also request a method to only print the IDE formatted
failure line. (IE: "filname(line): error: Error message") </p>
</div>
 
 
 </div>
 </div>
 

 
 <div class="artifactcomment">
 
 
 
 
 
 
 <span class="author">Comment
 
 by
 
 <a style="white-space: nowrap;" href="http://code.google.com/u/vladlosev/">vladlosev</a>,
 
 </span>
 <span class="date" title="Mon Dec 22 12:19:20 2008">Dec 22, 2008</span>
 <div>
<div class="commentcontent">
<p>We have issues logged to open the reporting interface (<a title="Support for custom ResultPrinter" class="closed_ref" href="http://code.google.com/p/googletest/issues/detail?id=58">&nbsp;issue 58&nbsp;</a>) and provide terser output (<a title="Suggestion: Terse Output Option" class="closed_ref" href="http://code.google.com/p/googletest/issues/detail?id=77">&nbsp;issue 77&nbsp;</a>). You can star those if you want to track their progress. </p><p>WRT
to IDE formatted lines, Google Test outputs test failures depending on
the compiler the code has been built with. Please look for the function
called FormatFileLocation<a href="http://code.google.com/p/googletest/w/edit/FormatFileLocation">?</a> in the code. If you see an instance of failure not reported in a correct format, please log an issue. </p>
</div>
 
 
 </div>
 </div>
 

</div>
</div>

 


 <script type="text/javascript">
 function delComment(sequence_num, delete_mode) {
 var f = document.forms["delcom"];
 f.sequence_num.value = sequence_num;
 f.mode.value = delete_mode;
 f.submit();
 return false;
 }
 </script>


 
 
<form name="delcom" action="../w/delComment.do" method="POST">
 <input name="sequence_num" value="" type="hidden">
 <input name="mode" value="" type="hidden">
 <input name="pagename" value="GoogleTestAdvancedGuide" type="hidden">
 <input name="token" value="" type="hidden">
</form>



<script src="GoogleTestAdvancedGuide_files/prettify.js"></script>
<script type="text/javascript">
 prettyPrint();
</script>
<script type="text/javascript" src="GoogleTestAdvancedGuide_files/dit_scripts_20081013.js"></script>



  
 
 <script type="text/javascript" src="GoogleTestAdvancedGuide_files/core_scripts_20081103.js"></script>
 <script type="text/javascript" src="GoogleTestAdvancedGuide_files/codesite_product_dictionary_ph.js"></script>
 </div>
<div id="footer" dir="ltr">
 
 <div class="text">
 
 Â©2010 Google -
 <a href="http://code.google.com/projecthosting/terms.html">Terms</a> -
 <a href="http://www.google.com/privacy.html">Privacy</a> -
 <a href="http://code.google.com/p/support/">Project Hosting Help</a>
 
 </div>
</div>

 <div class="hostedBy" style="margin-top: -20px;">
 <span style="vertical-align: top;">Powered by <a href="http://code.google.com/projecthosting/">Google Project Hosting</a></span>
 </div>
 
 


 
 <div style="display: none;" id="menuDiv-projects-dropdown" class="menuDiv instance0"><div class="menuCategory controls"><a href="http://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogletest%2Fwiki%2FGoogleTestAdvancedGuide&amp;amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogletest%2Fwiki%2FGoogleTestAdvancedGuide" style="display: block;" class="menuItem">Sign in to see your favorites</a><hr class="menuSeparator"><a href="http://code.google.com/more/" style="display: block;" class="menuItem">Find developer products...</a><a href="http://code.google.com/hosting/" style="display: block;" class="menuItem">Find open source projects...</a></div></div></body></html>